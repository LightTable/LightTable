// Compiled by ClojureScript 1.10.844 {}
goog.provide('singultus.compiler');
goog.require('cljs.core');
goog.require('goog.dom');
goog.require('goog.style');
goog.require('clojure.string');
goog.require('singultus.binding');
singultus.compiler.xmlns = new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword(null,"xhtml","xhtml",1912943770),"http://www.w3.org/1999/xhtml",new cljs.core.Keyword(null,"svg","svg",856789142),"http://www.w3.org/2000/svg"], null);


singultus.compiler.group_id = cljs.core.atom.call(null,(0));
singultus.compiler.bindings = cljs.core.atom.call(null,cljs.core.PersistentVector.EMPTY);
singultus.compiler.capture_binding = (function singultus$compiler$capture_binding(tag,b){
return cljs.core.swap_BANG_.call(null,singultus.compiler.bindings,cljs.core.conj,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [tag,b], null));
});

/**
 * @interface
 */
singultus.compiler.Element = function(){};

var singultus$compiler$Element$_elem$dyn_5805 = (function (this$){
var x__4463__auto__ = (((this$ == null))?null:this$);
var m__4464__auto__ = (singultus.compiler._elem[goog.typeOf(x__4463__auto__)]);
if((!((m__4464__auto__ == null)))){
return m__4464__auto__.call(null,this$);
} else {
var m__4461__auto__ = (singultus.compiler._elem["_"]);
if((!((m__4461__auto__ == null)))){
return m__4461__auto__.call(null,this$);
} else {
throw cljs.core.missing_protocol.call(null,"Element.-elem",this$);
}
}
});
singultus.compiler._elem = (function singultus$compiler$_elem(this$){
if((((!((this$ == null)))) && ((!((this$.singultus$compiler$Element$_elem$arity$1 == null)))))){
return this$.singultus$compiler$Element$_elem$arity$1(this$);
} else {
return singultus$compiler$Element$_elem$dyn_5805.call(null,this$);
}
});

singultus.compiler.as_content = (function singultus$compiler$as_content(parent,content){
var seq__5806 = cljs.core.seq.call(null,content);
var chunk__5807 = null;
var count__5808 = (0);
var i__5809 = (0);
while(true){
if((i__5809 < count__5808)){
var c = cljs.core._nth.call(null,chunk__5807,i__5809);
var child_5814 = (((((!((c == null))))?((((false) || ((cljs.core.PROTOCOL_SENTINEL === c.singultus$compiler$Element$))))?true:(((!c.cljs$lang$protocol_mask$partition$))?cljs.core.native_satisfies_QMARK_.call(null,singultus.compiler.Element,c):false)):cljs.core.native_satisfies_QMARK_.call(null,singultus.compiler.Element,c)))?singultus.compiler._elem.call(null,c):(((c == null))?null:((cljs.core.map_QMARK_.call(null,c))?(function(){throw "Maps cannot be used as content"})():((typeof c === 'string')?goog.dom.createTextNode(c):((cljs.core.vector_QMARK_.call(null,c))?singultus.compiler.elem_factory.call(null,c):((cljs.core.seq_QMARK_.call(null,c))?singultus.compiler.as_content.call(null,parent,c):((singultus.binding.binding_coll_QMARK_.call(null,c))?(function (){
singultus.compiler.capture_binding.call(null,new cljs.core.Keyword(null,"coll","coll",1647737163),c);

return singultus.compiler.as_content.call(null,parent,new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [singultus.binding.value.call(null,c)], null));
})()
:((singultus.binding.binding_QMARK_.call(null,c))?(function (){
singultus.compiler.capture_binding.call(null,new cljs.core.Keyword(null,"text","text",-1790561697),c);

return singultus.compiler.as_content.call(null,parent,new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [singultus.binding.value.call(null,c)], null));
})()
:(cljs.core.truth_(c.nodeName)?c:(cljs.core.truth_(c.get)?c.get((0)):goog.dom.createTextNode(cljs.core.str.cljs$core$IFn$_invoke$arity$1(c))
))))))))));
if(cljs.core.truth_(child_5814)){
goog.dom.appendChild(parent,child_5814);
} else {
}


var G__5815 = seq__5806;
var G__5816 = chunk__5807;
var G__5817 = count__5808;
var G__5818 = (i__5809 + (1));
seq__5806 = G__5815;
chunk__5807 = G__5816;
count__5808 = G__5817;
i__5809 = G__5818;
continue;
} else {
var temp__5753__auto__ = cljs.core.seq.call(null,seq__5806);
if(temp__5753__auto__){
var seq__5806__$1 = temp__5753__auto__;
if(cljs.core.chunked_seq_QMARK_.call(null,seq__5806__$1)){
var c__4591__auto__ = cljs.core.chunk_first.call(null,seq__5806__$1);
var G__5819 = cljs.core.chunk_rest.call(null,seq__5806__$1);
var G__5820 = c__4591__auto__;
var G__5821 = cljs.core.count.call(null,c__4591__auto__);
var G__5822 = (0);
seq__5806 = G__5819;
chunk__5807 = G__5820;
count__5808 = G__5821;
i__5809 = G__5822;
continue;
} else {
var c = cljs.core.first.call(null,seq__5806__$1);
var child_5823 = (((((!((c == null))))?((((false) || ((cljs.core.PROTOCOL_SENTINEL === c.singultus$compiler$Element$))))?true:(((!c.cljs$lang$protocol_mask$partition$))?cljs.core.native_satisfies_QMARK_.call(null,singultus.compiler.Element,c):false)):cljs.core.native_satisfies_QMARK_.call(null,singultus.compiler.Element,c)))?singultus.compiler._elem.call(null,c):(((c == null))?null:((cljs.core.map_QMARK_.call(null,c))?(function(){throw "Maps cannot be used as content"})():((typeof c === 'string')?goog.dom.createTextNode(c):((cljs.core.vector_QMARK_.call(null,c))?singultus.compiler.elem_factory.call(null,c):((cljs.core.seq_QMARK_.call(null,c))?singultus.compiler.as_content.call(null,parent,c):((singultus.binding.binding_coll_QMARK_.call(null,c))?(function (){
singultus.compiler.capture_binding.call(null,new cljs.core.Keyword(null,"coll","coll",1647737163),c);

return singultus.compiler.as_content.call(null,parent,new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [singultus.binding.value.call(null,c)], null));
})()
:((singultus.binding.binding_QMARK_.call(null,c))?(function (){
singultus.compiler.capture_binding.call(null,new cljs.core.Keyword(null,"text","text",-1790561697),c);

return singultus.compiler.as_content.call(null,parent,new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [singultus.binding.value.call(null,c)], null));
})()
:(cljs.core.truth_(c.nodeName)?c:(cljs.core.truth_(c.get)?c.get((0)):goog.dom.createTextNode(cljs.core.str.cljs$core$IFn$_invoke$arity$1(c))
))))))))));
if(cljs.core.truth_(child_5823)){
goog.dom.appendChild(parent,child_5823);
} else {
}


var G__5824 = cljs.core.next.call(null,seq__5806__$1);
var G__5825 = null;
var G__5826 = (0);
var G__5827 = (0);
seq__5806 = G__5824;
chunk__5807 = G__5825;
count__5808 = G__5826;
i__5809 = G__5827;
continue;
}
} else {
return null;
}
}
break;
}
});
if((typeof singultus !== 'undefined') && (typeof singultus.compiler !== 'undefined') && (typeof singultus.compiler.dom_binding !== 'undefined')){
} else {
singultus.compiler.dom_binding = (function (){var method_table__4654__auto__ = cljs.core.atom.call(null,cljs.core.PersistentArrayMap.EMPTY);
var prefer_table__4655__auto__ = cljs.core.atom.call(null,cljs.core.PersistentArrayMap.EMPTY);
var method_cache__4656__auto__ = cljs.core.atom.call(null,cljs.core.PersistentArrayMap.EMPTY);
var cached_hierarchy__4657__auto__ = cljs.core.atom.call(null,cljs.core.PersistentArrayMap.EMPTY);
var hierarchy__4658__auto__ = cljs.core.get.call(null,cljs.core.PersistentArrayMap.EMPTY,new cljs.core.Keyword(null,"hierarchy","hierarchy",-1053470341),cljs.core.get_global_hierarchy.call(null));
return (new cljs.core.MultiFn(cljs.core.symbol.call(null,"singultus.compiler","dom-binding"),(function (type,_,___$1){
return type;
}),new cljs.core.Keyword(null,"default","default",-1987822328),hierarchy__4658__auto__,method_table__4654__auto__,prefer_table__4655__auto__,method_cache__4656__auto__,cached_hierarchy__4657__auto__));
})();
}
cljs.core._add_method.call(null,singultus.compiler.dom_binding,new cljs.core.Keyword(null,"text","text",-1790561697),(function (_,b,elem){
return singultus.binding.on_change.call(null,b,(function (v){
goog.dom.removeChildren(elem);

return singultus.compiler.as_content.call(null,elem,new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [v], null));
}));
}));
cljs.core._add_method.call(null,singultus.compiler.dom_binding,new cljs.core.Keyword(null,"attr","attr",-604132353),(function (_,p__5828,elem){
var vec__5829 = p__5828;
var k = cljs.core.nth.call(null,vec__5829,(0),null);
var b = cljs.core.nth.call(null,vec__5829,(1),null);
return singultus.binding.on_change.call(null,b,(function (v){
return singultus.compiler.dom_attr.call(null,elem,k,v);
}));
}));
cljs.core._add_method.call(null,singultus.compiler.dom_binding,new cljs.core.Keyword(null,"style","style",-496642736),(function (_,p__5832,elem){
var vec__5833 = p__5832;
var k = cljs.core.nth.call(null,vec__5833,(0),null);
var b = cljs.core.nth.call(null,vec__5833,(1),null);
return singultus.binding.on_change.call(null,b,(function (v){
if(cljs.core.truth_(k)){
return singultus.compiler.dom_style.call(null,elem,k,v);
} else {
return singultus.compiler.dom_style.call(null,elem,v);
}
}));
}));
singultus.compiler.dom_add = (function singultus$compiler$dom_add(bc,parent,elem,v){
var temp__5751__auto__ = singultus.binding.opt.call(null,bc,new cljs.core.Keyword(null,"add","add",235287739));
if(cljs.core.truth_(temp__5751__auto__)){
var adder = temp__5751__auto__;
return adder.call(null,parent,elem,v);
} else {
return goog.dom.appendChild(parent,elem);
}
});
singultus.compiler.dom_remove = (function singultus$compiler$dom_remove(bc,elem){
var temp__5751__auto__ = singultus.binding.opt.call(null,bc,new cljs.core.Keyword(null,"remove","remove",-131428414));
if(cljs.core.truth_(temp__5751__auto__)){
var remover = temp__5751__auto__;
return remover.call(null,elem);
} else {
return goog.dom.removeNode(elem);
}
});
cljs.core._add_method.call(null,singultus.compiler.dom_binding,new cljs.core.Keyword(null,"coll","coll",1647737163),(function (_,bc,parent){
return singultus.binding.on_change.call(null,bc,(function (type,elem,v){
var pred__5836 = cljs.core._EQ_;
var expr__5837 = type;
if(cljs.core.truth_(pred__5836.call(null,new cljs.core.Keyword(null,"add","add",235287739),expr__5837))){
return singultus.compiler.dom_add.call(null,bc,parent,elem,v);
} else {
if(cljs.core.truth_(pred__5836.call(null,new cljs.core.Keyword(null,"remove","remove",-131428414),expr__5837))){
return singultus.compiler.dom_remove.call(null,bc,elem);
} else {
throw (new Error(["No matching clause: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(expr__5837)].join('')));
}
}
}));
}));
singultus.compiler.handle_bindings = (function singultus$compiler$handle_bindings(bs,elem){
var seq__5839 = cljs.core.seq.call(null,bs);
var chunk__5840 = null;
var count__5841 = (0);
var i__5842 = (0);
while(true){
if((i__5842 < count__5841)){
var vec__5849 = cljs.core._nth.call(null,chunk__5840,i__5842);
var type = cljs.core.nth.call(null,vec__5849,(0),null);
var b = cljs.core.nth.call(null,vec__5849,(1),null);
singultus.compiler.dom_binding.call(null,type,b,elem);


var G__5855 = seq__5839;
var G__5856 = chunk__5840;
var G__5857 = count__5841;
var G__5858 = (i__5842 + (1));
seq__5839 = G__5855;
chunk__5840 = G__5856;
count__5841 = G__5857;
i__5842 = G__5858;
continue;
} else {
var temp__5753__auto__ = cljs.core.seq.call(null,seq__5839);
if(temp__5753__auto__){
var seq__5839__$1 = temp__5753__auto__;
if(cljs.core.chunked_seq_QMARK_.call(null,seq__5839__$1)){
var c__4591__auto__ = cljs.core.chunk_first.call(null,seq__5839__$1);
var G__5859 = cljs.core.chunk_rest.call(null,seq__5839__$1);
var G__5860 = c__4591__auto__;
var G__5861 = cljs.core.count.call(null,c__4591__auto__);
var G__5862 = (0);
seq__5839 = G__5859;
chunk__5840 = G__5860;
count__5841 = G__5861;
i__5842 = G__5862;
continue;
} else {
var vec__5852 = cljs.core.first.call(null,seq__5839__$1);
var type = cljs.core.nth.call(null,vec__5852,(0),null);
var b = cljs.core.nth.call(null,vec__5852,(1),null);
singultus.compiler.dom_binding.call(null,type,b,elem);


var G__5863 = cljs.core.next.call(null,seq__5839__$1);
var G__5864 = null;
var G__5865 = (0);
var G__5866 = (0);
seq__5839 = G__5863;
chunk__5840 = G__5864;
count__5841 = G__5865;
i__5842 = G__5866;
continue;
}
} else {
return null;
}
}
break;
}
});
singultus.compiler.dom_style = (function singultus$compiler$dom_style(var_args){
var G__5868 = arguments.length;
switch (G__5868) {
case 2:
return singultus.compiler.dom_style.cljs$core$IFn$_invoke$arity$2((arguments[(0)]),(arguments[(1)]));

break;
case 3:
return singultus.compiler.dom_style.cljs$core$IFn$_invoke$arity$3((arguments[(0)]),(arguments[(1)]),(arguments[(2)]));

break;
default:
throw (new Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join('')));

}
});

(singultus.compiler.dom_style.cljs$core$IFn$_invoke$arity$2 = (function (elem,v){
if(typeof v === 'string'){
elem.setAttribute("style",v);
} else {
if(cljs.core.map_QMARK_.call(null,v)){
var seq__5869_5886 = cljs.core.seq.call(null,v);
var chunk__5870_5887 = null;
var count__5871_5888 = (0);
var i__5872_5889 = (0);
while(true){
if((i__5872_5889 < count__5871_5888)){
var vec__5879_5890 = cljs.core._nth.call(null,chunk__5870_5887,i__5872_5889);
var k_5891 = cljs.core.nth.call(null,vec__5879_5890,(0),null);
var v_5892__$1 = cljs.core.nth.call(null,vec__5879_5890,(1),null);
singultus.compiler.dom_style.call(null,elem,k_5891,v_5892__$1);


var G__5893 = seq__5869_5886;
var G__5894 = chunk__5870_5887;
var G__5895 = count__5871_5888;
var G__5896 = (i__5872_5889 + (1));
seq__5869_5886 = G__5893;
chunk__5870_5887 = G__5894;
count__5871_5888 = G__5895;
i__5872_5889 = G__5896;
continue;
} else {
var temp__5753__auto___5897 = cljs.core.seq.call(null,seq__5869_5886);
if(temp__5753__auto___5897){
var seq__5869_5898__$1 = temp__5753__auto___5897;
if(cljs.core.chunked_seq_QMARK_.call(null,seq__5869_5898__$1)){
var c__4591__auto___5899 = cljs.core.chunk_first.call(null,seq__5869_5898__$1);
var G__5900 = cljs.core.chunk_rest.call(null,seq__5869_5898__$1);
var G__5901 = c__4591__auto___5899;
var G__5902 = cljs.core.count.call(null,c__4591__auto___5899);
var G__5903 = (0);
seq__5869_5886 = G__5900;
chunk__5870_5887 = G__5901;
count__5871_5888 = G__5902;
i__5872_5889 = G__5903;
continue;
} else {
var vec__5882_5904 = cljs.core.first.call(null,seq__5869_5898__$1);
var k_5905 = cljs.core.nth.call(null,vec__5882_5904,(0),null);
var v_5906__$1 = cljs.core.nth.call(null,vec__5882_5904,(1),null);
singultus.compiler.dom_style.call(null,elem,k_5905,v_5906__$1);


var G__5907 = cljs.core.next.call(null,seq__5869_5898__$1);
var G__5908 = null;
var G__5909 = (0);
var G__5910 = (0);
seq__5869_5886 = G__5907;
chunk__5870_5887 = G__5908;
count__5871_5888 = G__5909;
i__5872_5889 = G__5910;
continue;
}
} else {
}
}
break;
}
} else {
if(singultus.binding.binding_QMARK_.call(null,v)){
singultus.compiler.capture_binding.call(null,new cljs.core.Keyword(null,"style","style",-496642736),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [null,v], null));

singultus.compiler.dom_style.call(null,elem,singultus.binding.value.call(null,v));
} else {
}
}
}

return elem;
}));

(singultus.compiler.dom_style.cljs$core$IFn$_invoke$arity$3 = (function (elem,k,v){
var v__$1 = ((singultus.binding.binding_QMARK_.call(null,v))?(function (){
singultus.compiler.capture_binding.call(null,new cljs.core.Keyword(null,"style","style",-496642736),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [k,v], null));

return singultus.binding.value.call(null,v);
})()
:v);
return goog.style.setStyle(elem,cljs.core.name.call(null,k),v__$1);
}));

(singultus.compiler.dom_style.cljs$lang$maxFixedArity = 3);

singultus.compiler.dom_attr = (function singultus$compiler$dom_attr(var_args){
var G__5912 = arguments.length;
switch (G__5912) {
case 2:
return singultus.compiler.dom_attr.cljs$core$IFn$_invoke$arity$2((arguments[(0)]),(arguments[(1)]));

break;
case 3:
return singultus.compiler.dom_attr.cljs$core$IFn$_invoke$arity$3((arguments[(0)]),(arguments[(1)]),(arguments[(2)]));

break;
default:
throw (new Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join('')));

}
});

(singultus.compiler.dom_attr.cljs$core$IFn$_invoke$arity$2 = (function (elem,attrs){
if(cljs.core.truth_(elem)){
if((!(cljs.core.map_QMARK_.call(null,attrs)))){
return elem.getAttribute(cljs.core.name.call(null,attrs));
} else {
var seq__5913_5930 = cljs.core.seq.call(null,attrs);
var chunk__5914_5931 = null;
var count__5915_5932 = (0);
var i__5916_5933 = (0);
while(true){
if((i__5916_5933 < count__5915_5932)){
var vec__5923_5934 = cljs.core._nth.call(null,chunk__5914_5931,i__5916_5933);
var k_5935 = cljs.core.nth.call(null,vec__5923_5934,(0),null);
var v_5936 = cljs.core.nth.call(null,vec__5923_5934,(1),null);
singultus.compiler.dom_attr.call(null,elem,k_5935,v_5936);


var G__5937 = seq__5913_5930;
var G__5938 = chunk__5914_5931;
var G__5939 = count__5915_5932;
var G__5940 = (i__5916_5933 + (1));
seq__5913_5930 = G__5937;
chunk__5914_5931 = G__5938;
count__5915_5932 = G__5939;
i__5916_5933 = G__5940;
continue;
} else {
var temp__5753__auto___5941 = cljs.core.seq.call(null,seq__5913_5930);
if(temp__5753__auto___5941){
var seq__5913_5942__$1 = temp__5753__auto___5941;
if(cljs.core.chunked_seq_QMARK_.call(null,seq__5913_5942__$1)){
var c__4591__auto___5943 = cljs.core.chunk_first.call(null,seq__5913_5942__$1);
var G__5944 = cljs.core.chunk_rest.call(null,seq__5913_5942__$1);
var G__5945 = c__4591__auto___5943;
var G__5946 = cljs.core.count.call(null,c__4591__auto___5943);
var G__5947 = (0);
seq__5913_5930 = G__5944;
chunk__5914_5931 = G__5945;
count__5915_5932 = G__5946;
i__5916_5933 = G__5947;
continue;
} else {
var vec__5926_5948 = cljs.core.first.call(null,seq__5913_5942__$1);
var k_5949 = cljs.core.nth.call(null,vec__5926_5948,(0),null);
var v_5950 = cljs.core.nth.call(null,vec__5926_5948,(1),null);
singultus.compiler.dom_attr.call(null,elem,k_5949,v_5950);


var G__5951 = cljs.core.next.call(null,seq__5913_5942__$1);
var G__5952 = null;
var G__5953 = (0);
var G__5954 = (0);
seq__5913_5930 = G__5951;
chunk__5914_5931 = G__5952;
count__5915_5932 = G__5953;
i__5916_5933 = G__5954;
continue;
}
} else {
}
}
break;
}

return elem;
}
} else {
return null;
}
}));

(singultus.compiler.dom_attr.cljs$core$IFn$_invoke$arity$3 = (function (elem,k,v){
if(cljs.core._EQ_.call(null,k,new cljs.core.Keyword(null,"style","style",-496642736))){
singultus.compiler.dom_style.call(null,elem,v);
} else {
var v_5955__$1 = ((singultus.binding.binding_QMARK_.call(null,v))?(function (){
singultus.compiler.capture_binding.call(null,new cljs.core.Keyword(null,"attr","attr",-604132353),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [k,v], null));

return singultus.binding.value.call(null,v);
})()
:v);
var event_5956 = cljs.core.second.call(null,cljs.core.re_find.call(null,/^on(\w+)/,cljs.core.name.call(null,k)));
if(cljs.core.truth_(event_5956)){
elem.addEventListener(event_5956,v_5955__$1);
} else {
elem.setAttribute(cljs.core.name.call(null,k),v_5955__$1);
}
}

return elem;
}));

(singultus.compiler.dom_attr.cljs$lang$maxFixedArity = 3);

/**
 * Regular expression that parses a CSS-style id and class from a tag name.
 */
singultus.compiler.re_tag = /([^\s\.#]+)(?:#([^\s\.#]+))?(?:\.([^\s#]+))?/;
singultus.compiler.normalize_map_attrs = (function singultus$compiler$normalize_map_attrs(map_attrs){
return cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,cljs.core.map.call(null,(function (p__5957){
var vec__5958 = p__5957;
var n = cljs.core.nth.call(null,vec__5958,(0),null);
var v = cljs.core.nth.call(null,vec__5958,(1),null);
if(v === true){
return new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [n,cljs.core.name.call(null,n)], null);
} else {
return new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [n,v], null);
}
}),cljs.core.filter.call(null,cljs.core.comp.call(null,cljs.core.boolean$,cljs.core.second),map_attrs)));
});
/**
 * Ensure a tag vector is of the form [tag-name attrs content].
 */
singultus.compiler.normalize_element = (function singultus$compiler$normalize_element(p__5962){
var vec__5963 = p__5962;
var seq__5964 = cljs.core.seq.call(null,vec__5963);
var first__5965 = cljs.core.first.call(null,seq__5964);
var seq__5964__$1 = cljs.core.next.call(null,seq__5964);
var tag = first__5965;
var content = seq__5964__$1;
if((!((((tag instanceof cljs.core.Keyword)) || ((tag instanceof cljs.core.Symbol)) || (typeof tag === 'string'))))){
throw [cljs.core.str.cljs$core$IFn$_invoke$arity$1(tag)," is not a valid tag name."].join('');
} else {
}

var vec__5966 = cljs.core.re_matches.call(null,singultus.compiler.re_tag,cljs.core.name.call(null,tag));
var _ = cljs.core.nth.call(null,vec__5966,(0),null);
var tag__$1 = cljs.core.nth.call(null,vec__5966,(1),null);
var id = cljs.core.nth.call(null,vec__5966,(2),null);
var class$ = cljs.core.nth.call(null,vec__5966,(3),null);
var vec__5969 = (function (){var vec__5972 = clojure.string.split.call(null,tag__$1,/:/);
var nsp = cljs.core.nth.call(null,vec__5972,(0),null);
var t = cljs.core.nth.call(null,vec__5972,(1),null);
var ns_xmlns = singultus.compiler.xmlns.call(null,cljs.core.keyword.call(null,nsp));
if(cljs.core.truth_(t)){
return new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [(function (){var or__4160__auto__ = ns_xmlns;
if(cljs.core.truth_(or__4160__auto__)){
return or__4160__auto__;
} else {
return nsp;
}
})(),t], null);
} else {
return new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"xhtml","xhtml",1912943770).cljs$core$IFn$_invoke$arity$1(singultus.compiler.xmlns),nsp], null);
}
})();
var nsp = cljs.core.nth.call(null,vec__5969,(0),null);
var tag__$2 = cljs.core.nth.call(null,vec__5969,(1),null);
var tag_attrs = cljs.core.into.call(null,cljs.core.PersistentArrayMap.EMPTY,cljs.core.filter.call(null,(function (p1__5961_SHARP_){
return (!((cljs.core.second.call(null,p1__5961_SHARP_) == null)));
}),new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword(null,"id","id",-1388402092),(function (){var or__4160__auto__ = id;
if(cljs.core.truth_(or__4160__auto__)){
return or__4160__auto__;
} else {
return null;
}
})(),new cljs.core.Keyword(null,"class","class",-2030961996),(cljs.core.truth_(class$)?clojure.string.replace.call(null,class$,/\./," "):null)], null)));
var map_attrs = cljs.core.first.call(null,content);
if(cljs.core.map_QMARK_.call(null,map_attrs)){
return new cljs.core.PersistentVector(null, 4, 5, cljs.core.PersistentVector.EMPTY_NODE, [nsp,tag__$2,cljs.core.merge.call(null,tag_attrs,singultus.compiler.normalize_map_attrs.call(null,map_attrs)),cljs.core.next.call(null,content)], null);
} else {
return new cljs.core.PersistentVector(null, 4, 5, cljs.core.PersistentVector.EMPTY_NODE, [nsp,tag__$2,tag_attrs,content], null);
}
});
singultus.compiler.parse_content = (function singultus$compiler$parse_content(elem,content){
var attrs = cljs.core.first.call(null,content);
if(cljs.core.map_QMARK_.call(null,attrs)){
singultus.compiler.dom_attr.call(null,elem,attrs);

return cljs.core.rest.call(null,content);
} else {
return content;
}
});
singultus.compiler.create_elem = (cljs.core.truth_(document.createElementNS)?(function (nsp,tag){
return document.createElementNS(nsp,tag);
}):(function (_,tag){
return document.createElement(tag);
}));
singultus.compiler.elem_factory = (function singultus$compiler$elem_factory(tag_def){
var bindings_orig_val__5975 = singultus.compiler.bindings;
var bindings_temp_val__5976 = cljs.core.atom.call(null,cljs.core.PersistentVector.EMPTY);
(singultus.compiler.bindings = bindings_temp_val__5976);

try{var vec__5977 = singultus.compiler.normalize_element.call(null,tag_def);
var nsp = cljs.core.nth.call(null,vec__5977,(0),null);
var tag = cljs.core.nth.call(null,vec__5977,(1),null);
var attrs = cljs.core.nth.call(null,vec__5977,(2),null);
var content = cljs.core.nth.call(null,vec__5977,(3),null);
var elem = singultus.compiler.create_elem.call(null,nsp,tag);
var onclick = new cljs.core.Keyword(null,"onclick","onclick",1297553739).cljs$core$IFn$_invoke$arity$1(attrs);
singultus.compiler.dom_attr.call(null,elem,attrs);

singultus.compiler.as_content.call(null,elem,content);

singultus.compiler.handle_bindings.call(null,cljs.core.deref.call(null,singultus.compiler.bindings),elem);

return elem;
}finally {(singultus.compiler.bindings = bindings_orig_val__5975);
}});
/**
 * Add an optional attribute argument to a function that returns a vector tag.
 */
singultus.compiler.add_optional_attrs = (function singultus$compiler$add_optional_attrs(func){
return (function() { 
var G__5983__delegate = function (args){
if(cljs.core.map_QMARK_.call(null,cljs.core.first.call(null,args))){
var vec__5980 = cljs.core.apply.call(null,func,cljs.core.rest.call(null,args));
var seq__5981 = cljs.core.seq.call(null,vec__5980);
var first__5982 = cljs.core.first.call(null,seq__5981);
var seq__5981__$1 = cljs.core.next.call(null,seq__5981);
var tag = first__5982;
var body = seq__5981__$1;
if(cljs.core.map_QMARK_.call(null,cljs.core.first.call(null,body))){
return cljs.core.apply.call(null,cljs.core.vector,tag,cljs.core.merge.call(null,cljs.core.first.call(null,body),cljs.core.first.call(null,args)),cljs.core.rest.call(null,body));
} else {
return cljs.core.apply.call(null,cljs.core.vector,tag,cljs.core.first.call(null,args),body);
}
} else {
return cljs.core.apply.call(null,func,args);
}
};
var G__5983 = function (var_args){
var args = null;
if (arguments.length > 0) {
var G__5984__i = 0, G__5984__a = new Array(arguments.length -  0);
while (G__5984__i < G__5984__a.length) {G__5984__a[G__5984__i] = arguments[G__5984__i + 0]; ++G__5984__i;}
  args = new cljs.core.IndexedSeq(G__5984__a,0,null);
} 
return G__5983__delegate.call(this,args);};
G__5983.cljs$lang$maxFixedArity = 0;
G__5983.cljs$lang$applyTo = (function (arglist__5985){
var args = cljs.core.seq(arglist__5985);
return G__5983__delegate(args);
});
G__5983.cljs$core$IFn$_invoke$arity$variadic = G__5983__delegate;
return G__5983;
})()
;
});
