// Compiled by ClojureScript 1.10.844 {}
goog.provide('lt.object');
goog.require('cljs.core');
goog.require('singultus.core');
goog.require('clojure.set');
goog.require('clojure.string');
goog.require('singultus.binding');
goog.require('lt.util.cljs');
goog.require('lt.util.dom');
goog.require('lt.util.js');
/**
 * Counter to guarantee unique object ids
 */
lt.object.obj_id = cljs.core.atom.call(null,(0));
/**
 * Map of object ids to objects created by object/create
 */
lt.object.instances = cljs.core.atom.call(null,cljs.core.sorted_map.call(null));
/**
 * Map of behavior names to behaviors created by macros/behavior
 */
lt.object.behaviors = cljs.core.atom.call(null,cljs.core.PersistentArrayMap.EMPTY);
/**
 * Map of object template keys to template maps created by object/object*
 */
lt.object.object_defs = cljs.core.atom.call(null,cljs.core.PersistentArrayMap.EMPTY);
/**
 * Map of tags to associated lists of behaviors
 */
lt.object.tags = cljs.core.atom.call(null,cljs.core.PersistentArrayMap.EMPTY);
/**
 * Map of tags to dissociated lists of behaviors e.g. :-behavior
 */
lt.object.negated_tags = cljs.core.atom.call(null,cljs.core.PersistentArrayMap.EMPTY);
/**
 * Metadata of current behavior set during raise and raise-reduce
 */
lt.object._STAR_behavior_meta_STAR_ = null;
lt.object.add = (function lt$object$add(obj){
return cljs.core.swap_BANG_.call(null,lt.object.object_defs,cljs.core.assoc,new cljs.core.Keyword("lt.object","type","lt.object/type",1624522497).cljs$core$IFn$_invoke$arity$1(obj),obj);
});
lt.object.add_behavior = (function lt$object$add_behavior(beh){
return cljs.core.swap_BANG_.call(null,lt.object.behaviors,cljs.core.assoc,new cljs.core.Keyword(null,"name","name",1843675177).cljs$core$IFn$_invoke$arity$1(beh),beh);
});
/**
 * Return id of given object
 */
lt.object.__GT_id = (function lt$object$__GT_id(obj){
if(singultus.binding.deref_QMARK_.call(null,obj)){
return new cljs.core.Keyword("lt.object","id","lt.object/id",-955176977).cljs$core$IFn$_invoke$arity$1(cljs.core.deref.call(null,obj));
} else {
return new cljs.core.Keyword("lt.object","id","lt.object/id",-955176977).cljs$core$IFn$_invoke$arity$1(obj);
}
});
lt.object.__GT_behavior_name = (function lt$object$__GT_behavior_name(beh){
if(cljs.core.coll_QMARK_.call(null,beh)){
return cljs.core.first.call(null,beh);
} else {
return beh;
}
});
lt.object.__GT_behavior = (function lt$object$__GT_behavior(beh){
return cljs.core.deref.call(null,lt.object.behaviors).call(null,lt.object.__GT_behavior_name.call(null,beh));
});
lt.object.__GT_triggers = (function lt$object$__GT_triggers(behs){
var result = cljs.core.atom.call(null,cljs.core.transient$.call(null,cljs.core.PersistentArrayMap.EMPTY));
var seq__6054_6066 = cljs.core.seq.call(null,behs);
var chunk__6059_6067 = null;
var count__6060_6068 = (0);
var i__6061_6069 = (0);
while(true){
if((i__6061_6069 < count__6060_6068)){
var beh_6070 = cljs.core._nth.call(null,chunk__6059_6067,i__6061_6069);
var seq__6062_6071 = cljs.core.seq.call(null,new cljs.core.Keyword(null,"triggers","triggers",-1443678770).cljs$core$IFn$_invoke$arity$1(lt.object.__GT_behavior.call(null,beh_6070)));
var chunk__6063_6072 = null;
var count__6064_6073 = (0);
var i__6065_6074 = (0);
while(true){
if((i__6065_6074 < count__6064_6073)){
var t_6075 = cljs.core._nth.call(null,chunk__6063_6072,i__6065_6074);
cljs.core.swap_BANG_.call(null,result,cljs.core.assoc_BANG_,t_6075,cljs.core.conj.call(null,(function (){var or__4160__auto__ = cljs.core.get.call(null,cljs.core.deref.call(null,result),t_6075);
if(cljs.core.truth_(or__4160__auto__)){
return or__4160__auto__;
} else {
return cljs.core.PersistentVector.EMPTY;
}
})(),beh_6070));


var G__6076 = seq__6062_6071;
var G__6077 = chunk__6063_6072;
var G__6078 = count__6064_6073;
var G__6079 = (i__6065_6074 + (1));
seq__6062_6071 = G__6076;
chunk__6063_6072 = G__6077;
count__6064_6073 = G__6078;
i__6065_6074 = G__6079;
continue;
} else {
var temp__5753__auto___6080 = cljs.core.seq.call(null,seq__6062_6071);
if(temp__5753__auto___6080){
var seq__6062_6081__$1 = temp__5753__auto___6080;
if(cljs.core.chunked_seq_QMARK_.call(null,seq__6062_6081__$1)){
var c__4591__auto___6082 = cljs.core.chunk_first.call(null,seq__6062_6081__$1);
var G__6083 = cljs.core.chunk_rest.call(null,seq__6062_6081__$1);
var G__6084 = c__4591__auto___6082;
var G__6085 = cljs.core.count.call(null,c__4591__auto___6082);
var G__6086 = (0);
seq__6062_6071 = G__6083;
chunk__6063_6072 = G__6084;
count__6064_6073 = G__6085;
i__6065_6074 = G__6086;
continue;
} else {
var t_6087 = cljs.core.first.call(null,seq__6062_6081__$1);
cljs.core.swap_BANG_.call(null,result,cljs.core.assoc_BANG_,t_6087,cljs.core.conj.call(null,(function (){var or__4160__auto__ = cljs.core.get.call(null,cljs.core.deref.call(null,result),t_6087);
if(cljs.core.truth_(or__4160__auto__)){
return or__4160__auto__;
} else {
return cljs.core.PersistentVector.EMPTY;
}
})(),beh_6070));


var G__6088 = cljs.core.next.call(null,seq__6062_6081__$1);
var G__6089 = null;
var G__6090 = (0);
var G__6091 = (0);
seq__6062_6071 = G__6088;
chunk__6063_6072 = G__6089;
count__6064_6073 = G__6090;
i__6065_6074 = G__6091;
continue;
}
} else {
}
}
break;
}

var G__6092 = seq__6054_6066;
var G__6093 = chunk__6059_6067;
var G__6094 = count__6060_6068;
var G__6095 = (i__6061_6069 + (1));
seq__6054_6066 = G__6092;
chunk__6059_6067 = G__6093;
count__6060_6068 = G__6094;
i__6061_6069 = G__6095;
continue;
} else {
var temp__5753__auto___6096 = cljs.core.seq.call(null,seq__6054_6066);
if(temp__5753__auto___6096){
var seq__6054_6097__$1 = temp__5753__auto___6096;
if(cljs.core.chunked_seq_QMARK_.call(null,seq__6054_6097__$1)){
var c__4591__auto___6098 = cljs.core.chunk_first.call(null,seq__6054_6097__$1);
var G__6099 = cljs.core.chunk_rest.call(null,seq__6054_6097__$1);
var G__6100 = c__4591__auto___6098;
var G__6101 = cljs.core.count.call(null,c__4591__auto___6098);
var G__6102 = (0);
seq__6054_6066 = G__6099;
chunk__6059_6067 = G__6100;
count__6060_6068 = G__6101;
i__6061_6069 = G__6102;
continue;
} else {
var beh_6103 = cljs.core.first.call(null,seq__6054_6097__$1);
var seq__6055_6104 = cljs.core.seq.call(null,new cljs.core.Keyword(null,"triggers","triggers",-1443678770).cljs$core$IFn$_invoke$arity$1(lt.object.__GT_behavior.call(null,beh_6103)));
var chunk__6056_6105 = null;
var count__6057_6106 = (0);
var i__6058_6107 = (0);
while(true){
if((i__6058_6107 < count__6057_6106)){
var t_6108 = cljs.core._nth.call(null,chunk__6056_6105,i__6058_6107);
cljs.core.swap_BANG_.call(null,result,cljs.core.assoc_BANG_,t_6108,cljs.core.conj.call(null,(function (){var or__4160__auto__ = cljs.core.get.call(null,cljs.core.deref.call(null,result),t_6108);
if(cljs.core.truth_(or__4160__auto__)){
return or__4160__auto__;
} else {
return cljs.core.PersistentVector.EMPTY;
}
})(),beh_6103));


var G__6109 = seq__6055_6104;
var G__6110 = chunk__6056_6105;
var G__6111 = count__6057_6106;
var G__6112 = (i__6058_6107 + (1));
seq__6055_6104 = G__6109;
chunk__6056_6105 = G__6110;
count__6057_6106 = G__6111;
i__6058_6107 = G__6112;
continue;
} else {
var temp__5753__auto___6113__$1 = cljs.core.seq.call(null,seq__6055_6104);
if(temp__5753__auto___6113__$1){
var seq__6055_6114__$1 = temp__5753__auto___6113__$1;
if(cljs.core.chunked_seq_QMARK_.call(null,seq__6055_6114__$1)){
var c__4591__auto___6115 = cljs.core.chunk_first.call(null,seq__6055_6114__$1);
var G__6116 = cljs.core.chunk_rest.call(null,seq__6055_6114__$1);
var G__6117 = c__4591__auto___6115;
var G__6118 = cljs.core.count.call(null,c__4591__auto___6115);
var G__6119 = (0);
seq__6055_6104 = G__6116;
chunk__6056_6105 = G__6117;
count__6057_6106 = G__6118;
i__6058_6107 = G__6119;
continue;
} else {
var t_6120 = cljs.core.first.call(null,seq__6055_6114__$1);
cljs.core.swap_BANG_.call(null,result,cljs.core.assoc_BANG_,t_6120,cljs.core.conj.call(null,(function (){var or__4160__auto__ = cljs.core.get.call(null,cljs.core.deref.call(null,result),t_6120);
if(cljs.core.truth_(or__4160__auto__)){
return or__4160__auto__;
} else {
return cljs.core.PersistentVector.EMPTY;
}
})(),beh_6103));


var G__6121 = cljs.core.next.call(null,seq__6055_6114__$1);
var G__6122 = null;
var G__6123 = (0);
var G__6124 = (0);
seq__6055_6104 = G__6121;
chunk__6056_6105 = G__6122;
count__6057_6106 = G__6123;
i__6058_6107 = G__6124;
continue;
}
} else {
}
}
break;
}

var G__6125 = cljs.core.next.call(null,seq__6054_6097__$1);
var G__6126 = null;
var G__6127 = (0);
var G__6128 = (0);
seq__6054_6066 = G__6125;
chunk__6059_6067 = G__6126;
count__6060_6068 = G__6127;
i__6061_6069 = G__6128;
continue;
}
} else {
}
}
break;
}

return cljs.core.persistent_BANG_.call(null,cljs.core.deref.call(null,result));
});
lt.object.specificity_sort = (function lt$object$specificity_sort(var_args){
var G__6130 = arguments.length;
switch (G__6130) {
case 1:
return lt.object.specificity_sort.cljs$core$IFn$_invoke$arity$1((arguments[(0)]));

break;
case 2:
return lt.object.specificity_sort.cljs$core$IFn$_invoke$arity$2((arguments[(0)]),(arguments[(1)]));

break;
default:
throw (new Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join('')));

}
});

(lt.object.specificity_sort.cljs$core$IFn$_invoke$arity$1 = (function (xs){
return lt.object.specificity_sort.call(null,xs,null);
}));

(lt.object.specificity_sort.cljs$core$IFn$_invoke$arity$2 = (function (xs,dir){
var arr = [];
var seq__6131_6136 = cljs.core.seq.call(null,xs);
var chunk__6132_6137 = null;
var count__6133_6138 = (0);
var i__6134_6139 = (0);
while(true){
if((i__6134_6139 < count__6133_6138)){
var x_6140 = cljs.core._nth.call(null,chunk__6132_6137,i__6134_6139);
arr.push([cljs.core.str.cljs$core$IFn$_invoke$arity$1(x_6140).split(".").length,cljs.core.str.cljs$core$IFn$_invoke$arity$1(x_6140),x_6140]);


var G__6141 = seq__6131_6136;
var G__6142 = chunk__6132_6137;
var G__6143 = count__6133_6138;
var G__6144 = (i__6134_6139 + (1));
seq__6131_6136 = G__6141;
chunk__6132_6137 = G__6142;
count__6133_6138 = G__6143;
i__6134_6139 = G__6144;
continue;
} else {
var temp__5753__auto___6145 = cljs.core.seq.call(null,seq__6131_6136);
if(temp__5753__auto___6145){
var seq__6131_6146__$1 = temp__5753__auto___6145;
if(cljs.core.chunked_seq_QMARK_.call(null,seq__6131_6146__$1)){
var c__4591__auto___6147 = cljs.core.chunk_first.call(null,seq__6131_6146__$1);
var G__6148 = cljs.core.chunk_rest.call(null,seq__6131_6146__$1);
var G__6149 = c__4591__auto___6147;
var G__6150 = cljs.core.count.call(null,c__4591__auto___6147);
var G__6151 = (0);
seq__6131_6136 = G__6148;
chunk__6132_6137 = G__6149;
count__6133_6138 = G__6150;
i__6134_6139 = G__6151;
continue;
} else {
var x_6152 = cljs.core.first.call(null,seq__6131_6146__$1);
arr.push([cljs.core.str.cljs$core$IFn$_invoke$arity$1(x_6152).split(".").length,cljs.core.str.cljs$core$IFn$_invoke$arity$1(x_6152),x_6152]);


var G__6153 = cljs.core.next.call(null,seq__6131_6146__$1);
var G__6154 = null;
var G__6155 = (0);
var G__6156 = (0);
seq__6131_6136 = G__6153;
chunk__6132_6137 = G__6154;
count__6133_6138 = G__6155;
i__6134_6139 = G__6156;
continue;
}
} else {
}
}
break;
}

arr.sort();

if(cljs.core.truth_(dir)){
} else {
arr.reverse();
}

var arr__1087__auto___6157 = arr;
var i_6158 = (0);
while(true){
if((i_6158 < arr__1087__auto___6157.length)){
(arr[i_6158] = (arr[i_6158][(2)]));

var G__6159 = (i_6158 + (1));
i_6158 = G__6159;
continue;
} else {
}
break;
}

return arr;
}));

(lt.object.specificity_sort.cljs$lang$maxFixedArity = 2);

lt.object.ts__GT_negations = (function lt$object$ts__GT_negations(ts){
var seen = ({});
var seq__6162_6166 = cljs.core.seq.call(null,cljs.core.apply.call(null,cljs.core.concat,cljs.core.map.call(null,cljs.core.deref.call(null,lt.object.negated_tags),ts)));
var chunk__6163_6167 = null;
var count__6164_6168 = (0);
var i__6165_6169 = (0);
while(true){
if((i__6165_6169 < count__6164_6168)){
var beh_6170 = cljs.core._nth.call(null,chunk__6163_6167,i__6165_6169);
(seen[lt.object.__GT_behavior_name.call(null,beh_6170)] = true);


var G__6171 = seq__6162_6166;
var G__6172 = chunk__6163_6167;
var G__6173 = count__6164_6168;
var G__6174 = (i__6165_6169 + (1));
seq__6162_6166 = G__6171;
chunk__6163_6167 = G__6172;
count__6164_6168 = G__6173;
i__6165_6169 = G__6174;
continue;
} else {
var temp__5753__auto___6175 = cljs.core.seq.call(null,seq__6162_6166);
if(temp__5753__auto___6175){
var seq__6162_6176__$1 = temp__5753__auto___6175;
if(cljs.core.chunked_seq_QMARK_.call(null,seq__6162_6176__$1)){
var c__4591__auto___6177 = cljs.core.chunk_first.call(null,seq__6162_6176__$1);
var G__6178 = cljs.core.chunk_rest.call(null,seq__6162_6176__$1);
var G__6179 = c__4591__auto___6177;
var G__6180 = cljs.core.count.call(null,c__4591__auto___6177);
var G__6181 = (0);
seq__6162_6166 = G__6178;
chunk__6163_6167 = G__6179;
count__6164_6168 = G__6180;
i__6165_6169 = G__6181;
continue;
} else {
var beh_6182 = cljs.core.first.call(null,seq__6162_6176__$1);
(seen[lt.object.__GT_behavior_name.call(null,beh_6182)] = true);


var G__6183 = cljs.core.next.call(null,seq__6162_6176__$1);
var G__6184 = null;
var G__6185 = (0);
var G__6186 = (0);
seq__6162_6166 = G__6183;
chunk__6163_6167 = G__6184;
count__6164_6168 = G__6185;
i__6165_6169 = G__6186;
continue;
}
} else {
}
}
break;
}

return seen;
});
lt.object.tags__GT_behaviors = (function lt$object$tags__GT_behaviors(ts){
var duped = cljs.core.apply.call(null,cljs.core.concat,cljs.core.map.call(null,cljs.core.deref.call(null,lt.object.tags),lt.object.specificity_sort.call(null,ts)));
var de_duped = cljs.core.reduce.call(null,(function (res,cur){
if(cljs.core.truth_((new cljs.core.Keyword(null,"seen","seen",-518999789).cljs$core$IFn$_invoke$arity$1(res)[lt.object.__GT_behavior_name.call(null,cur)]))){
return res;
} else {
var beh = lt.object.__GT_behavior.call(null,cur);
if(cljs.core.truth_(new cljs.core.Keyword(null,"exclusive","exclusive",-1507998718).cljs$core$IFn$_invoke$arity$1(beh))){
if(cljs.core.coll_QMARK_.call(null,new cljs.core.Keyword(null,"exclusive","exclusive",-1507998718).cljs$core$IFn$_invoke$arity$1(beh))){
var seq__6187_6191 = cljs.core.seq.call(null,new cljs.core.Keyword(null,"exclusive","exclusive",-1507998718).cljs$core$IFn$_invoke$arity$1(beh));
var chunk__6188_6192 = null;
var count__6189_6193 = (0);
var i__6190_6194 = (0);
while(true){
if((i__6190_6194 < count__6189_6193)){
var exclude_6195 = cljs.core._nth.call(null,chunk__6188_6192,i__6190_6194);
(new cljs.core.Keyword(null,"seen","seen",-518999789).cljs$core$IFn$_invoke$arity$1(res)[exclude_6195] = true);


var G__6196 = seq__6187_6191;
var G__6197 = chunk__6188_6192;
var G__6198 = count__6189_6193;
var G__6199 = (i__6190_6194 + (1));
seq__6187_6191 = G__6196;
chunk__6188_6192 = G__6197;
count__6189_6193 = G__6198;
i__6190_6194 = G__6199;
continue;
} else {
var temp__5753__auto___6200 = cljs.core.seq.call(null,seq__6187_6191);
if(temp__5753__auto___6200){
var seq__6187_6201__$1 = temp__5753__auto___6200;
if(cljs.core.chunked_seq_QMARK_.call(null,seq__6187_6201__$1)){
var c__4591__auto___6202 = cljs.core.chunk_first.call(null,seq__6187_6201__$1);
var G__6203 = cljs.core.chunk_rest.call(null,seq__6187_6201__$1);
var G__6204 = c__4591__auto___6202;
var G__6205 = cljs.core.count.call(null,c__4591__auto___6202);
var G__6206 = (0);
seq__6187_6191 = G__6203;
chunk__6188_6192 = G__6204;
count__6189_6193 = G__6205;
i__6190_6194 = G__6206;
continue;
} else {
var exclude_6207 = cljs.core.first.call(null,seq__6187_6201__$1);
(new cljs.core.Keyword(null,"seen","seen",-518999789).cljs$core$IFn$_invoke$arity$1(res)[exclude_6207] = true);


var G__6208 = cljs.core.next.call(null,seq__6187_6201__$1);
var G__6209 = null;
var G__6210 = (0);
var G__6211 = (0);
seq__6187_6191 = G__6208;
chunk__6188_6192 = G__6209;
count__6189_6193 = G__6210;
i__6190_6194 = G__6211;
continue;
}
} else {
}
}
break;
}
} else {
}

(new cljs.core.Keyword(null,"seen","seen",-518999789).cljs$core$IFn$_invoke$arity$1(res)[lt.object.__GT_behavior_name.call(null,cur)] = true);
} else {
}

cljs.core.conj_BANG_.call(null,new cljs.core.Keyword(null,"final","final",1157881357).cljs$core$IFn$_invoke$arity$1(res),cur);

return res;
}
}),new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword(null,"seen","seen",-518999789),lt.object.ts__GT_negations.call(null,ts),new cljs.core.Keyword(null,"final","final",1157881357),cljs.core.transient$.call(null,cljs.core.PersistentVector.EMPTY)], null),duped);
return cljs.core.reverse.call(null,cljs.core.persistent_BANG_.call(null,new cljs.core.Keyword(null,"final","final",1157881357).cljs$core$IFn$_invoke$arity$1(de_duped)));
});
lt.object.trigger__GT_behaviors = (function lt$object$trigger__GT_behaviors(trig,ts){
return cljs.core.get.call(null,lt.object.__GT_triggers.call(null,lt.object.tags__GT_behaviors.call(null,ts)),trig);
});
lt.object.safe_report_error = (function lt$object$safe_report_error(e){
if(cljs.core.truth_(lt.objs.console)){
return lt.objs.console.error(e);
} else {
return console.error(((typeof e === 'string')?e:e.stack));
}
});
lt.object.raise_STAR_ = (function lt$object$raise_STAR_(var_args){
var G__6213 = arguments.length;
switch (G__6213) {
case 3:
return lt.object.raise_STAR_.cljs$core$IFn$_invoke$arity$3((arguments[(0)]),(arguments[(1)]),(arguments[(2)]));

break;
case 4:
return lt.object.raise_STAR_.cljs$core$IFn$_invoke$arity$4((arguments[(0)]),(arguments[(1)]),(arguments[(2)]),(arguments[(3)]));

break;
default:
throw (new Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join('')));

}
});

(lt.object.raise_STAR_.cljs$core$IFn$_invoke$arity$3 = (function (obj,reactions,args){
return lt.object.raise_STAR_.call(null,obj,reactions,args,null);
}));

(lt.object.raise_STAR_.cljs$core$IFn$_invoke$arity$4 = (function (obj,reactions,args,trigger){
var seq__6214 = cljs.core.seq.call(null,reactions);
var chunk__6217 = null;
var count__6218 = (0);
var i__6219 = (0);
while(true){
if((i__6219 < count__6218)){
var r = cljs.core._nth.call(null,chunk__6217,i__6219);
var func = new cljs.core.Keyword(null,"reaction","reaction",490869788).cljs$core$IFn$_invoke$arity$1(lt.object.__GT_behavior.call(null,r));
var args__$1 = ((cljs.core.coll_QMARK_.call(null,r))?cljs.core.concat.call(null,cljs.core.rest.call(null,r),args):args);
var meta = ((cljs.core.coll_QMARK_.call(null,r))?cljs.core.meta.call(null,r):cljs.core.PersistentArrayMap.EMPTY);
if(cljs.core.truth_(func)){
try{var start6231_6239 = (new Date()).getTime();
var _STAR_behavior_meta_STAR__orig_val__6232_6240 = lt.object._STAR_behavior_meta_STAR_;
var _STAR_behavior_meta_STAR__temp_val__6233_6241 = meta;
(lt.object._STAR_behavior_meta_STAR_ = _STAR_behavior_meta_STAR__temp_val__6233_6241);

try{cljs.core.apply.call(null,func,obj,args__$1);
}finally {(lt.object._STAR_behavior_meta_STAR_ = _STAR_behavior_meta_STAR__orig_val__6232_6240);
}
if(cljs.core._EQ_.call(null,trigger,new cljs.core.Keyword(null,"object.behavior.time","object.behavior.time",-1731850612))){
} else {
lt.object.raise.call(null,obj,new cljs.core.Keyword(null,"object.behavior.time","object.behavior.time",-1731850612),r,((new Date()).getTime() - start6231_6239),trigger);
}
}catch (e6230){var e_6242 = e6230;
lt.object.safe_report_error.call(null,["Invalid behavior: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(new cljs.core.Keyword(null,"name","name",1843675177).cljs$core$IFn$_invoke$arity$1(lt.object.__GT_behavior.call(null,r)))].join(''));

lt.object.safe_report_error.call(null,e_6242);
}

var G__6243 = seq__6214;
var G__6244 = chunk__6217;
var G__6245 = count__6218;
var G__6246 = (i__6219 + (1));
seq__6214 = G__6243;
chunk__6217 = G__6244;
count__6218 = G__6245;
i__6219 = G__6246;
continue;
} else {
var G__6247 = seq__6214;
var G__6248 = chunk__6217;
var G__6249 = count__6218;
var G__6250 = (i__6219 + (1));
seq__6214 = G__6247;
chunk__6217 = G__6248;
count__6218 = G__6249;
i__6219 = G__6250;
continue;
}
} else {
var temp__5753__auto__ = cljs.core.seq.call(null,seq__6214);
if(temp__5753__auto__){
var seq__6214__$1 = temp__5753__auto__;
if(cljs.core.chunked_seq_QMARK_.call(null,seq__6214__$1)){
var c__4591__auto__ = cljs.core.chunk_first.call(null,seq__6214__$1);
var G__6251 = cljs.core.chunk_rest.call(null,seq__6214__$1);
var G__6252 = c__4591__auto__;
var G__6253 = cljs.core.count.call(null,c__4591__auto__);
var G__6254 = (0);
seq__6214 = G__6251;
chunk__6217 = G__6252;
count__6218 = G__6253;
i__6219 = G__6254;
continue;
} else {
var r = cljs.core.first.call(null,seq__6214__$1);
var func = new cljs.core.Keyword(null,"reaction","reaction",490869788).cljs$core$IFn$_invoke$arity$1(lt.object.__GT_behavior.call(null,r));
var args__$1 = ((cljs.core.coll_QMARK_.call(null,r))?cljs.core.concat.call(null,cljs.core.rest.call(null,r),args):args);
var meta = ((cljs.core.coll_QMARK_.call(null,r))?cljs.core.meta.call(null,r):cljs.core.PersistentArrayMap.EMPTY);
if(cljs.core.truth_(func)){
try{var start6235_6255 = (new Date()).getTime();
var _STAR_behavior_meta_STAR__orig_val__6236_6256 = lt.object._STAR_behavior_meta_STAR_;
var _STAR_behavior_meta_STAR__temp_val__6237_6257 = meta;
(lt.object._STAR_behavior_meta_STAR_ = _STAR_behavior_meta_STAR__temp_val__6237_6257);

try{cljs.core.apply.call(null,func,obj,args__$1);
}finally {(lt.object._STAR_behavior_meta_STAR_ = _STAR_behavior_meta_STAR__orig_val__6236_6256);
}
if(cljs.core._EQ_.call(null,trigger,new cljs.core.Keyword(null,"object.behavior.time","object.behavior.time",-1731850612))){
} else {
lt.object.raise.call(null,obj,new cljs.core.Keyword(null,"object.behavior.time","object.behavior.time",-1731850612),r,((new Date()).getTime() - start6235_6255),trigger);
}
}catch (e6234){var e_6258 = e6234;
lt.object.safe_report_error.call(null,["Invalid behavior: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(new cljs.core.Keyword(null,"name","name",1843675177).cljs$core$IFn$_invoke$arity$1(lt.object.__GT_behavior.call(null,r)))].join(''));

lt.object.safe_report_error.call(null,e_6258);
}

var G__6259 = cljs.core.next.call(null,seq__6214__$1);
var G__6260 = null;
var G__6261 = (0);
var G__6262 = (0);
seq__6214 = G__6259;
chunk__6217 = G__6260;
count__6218 = G__6261;
i__6219 = G__6262;
continue;
} else {
var G__6263 = cljs.core.next.call(null,seq__6214__$1);
var G__6264 = null;
var G__6265 = (0);
var G__6266 = (0);
seq__6214 = G__6263;
chunk__6217 = G__6264;
count__6218 = G__6265;
i__6219 = G__6266;
continue;
}
}
} else {
return null;
}
}
break;
}
}));

(lt.object.raise_STAR_.cljs$lang$maxFixedArity = 4);

/**
 * Invoke object's behavior fns for given trigger. Args are passed to behavior fns
 */
lt.object.raise = (function lt$object$raise(var_args){
var args__4777__auto__ = [];
var len__4771__auto___6270 = arguments.length;
var i__4772__auto___6271 = (0);
while(true){
if((i__4772__auto___6271 < len__4771__auto___6270)){
args__4777__auto__.push((arguments[i__4772__auto___6271]));

var G__6272 = (i__4772__auto___6271 + (1));
i__4772__auto___6271 = G__6272;
continue;
} else {
}
break;
}

var argseq__4778__auto__ = ((((2) < args__4777__auto__.length))?(new cljs.core.IndexedSeq(args__4777__auto__.slice((2)),(0),null)):null);
return lt.object.raise.cljs$core$IFn$_invoke$arity$variadic((arguments[(0)]),(arguments[(1)]),argseq__4778__auto__);
});

(lt.object.raise.cljs$core$IFn$_invoke$arity$variadic = (function (obj,k,args){
var reactions = k.call(null,new cljs.core.Keyword(null,"listeners","listeners",394544445).cljs$core$IFn$_invoke$arity$1(cljs.core.deref.call(null,obj)));
return lt.object.raise_STAR_.call(null,obj,reactions,args,k);
}));

(lt.object.raise.cljs$lang$maxFixedArity = (2));

/** @this {Function} */
(lt.object.raise.cljs$lang$applyTo = (function (seq6267){
var G__6268 = cljs.core.first.call(null,seq6267);
var seq6267__$1 = cljs.core.next.call(null,seq6267);
var G__6269 = cljs.core.first.call(null,seq6267__$1);
var seq6267__$2 = cljs.core.next.call(null,seq6267__$1);
var self__4758__auto__ = this;
return self__4758__auto__.cljs$core$IFn$_invoke$arity$variadic(G__6268,G__6269,seq6267__$2);
}));

/**
 * For a given behavior keyword id, call its :reaction fn with given args
 */
lt.object.call_behavior_reaction = (function lt$object$call_behavior_reaction(var_args){
var args__4777__auto__ = [];
var len__4771__auto___6275 = arguments.length;
var i__4772__auto___6276 = (0);
while(true){
if((i__4772__auto___6276 < len__4771__auto___6275)){
args__4777__auto__.push((arguments[i__4772__auto___6276]));

var G__6277 = (i__4772__auto___6276 + (1));
i__4772__auto___6276 = G__6277;
continue;
} else {
}
break;
}

var argseq__4778__auto__ = ((((1) < args__4777__auto__.length))?(new cljs.core.IndexedSeq(args__4777__auto__.slice((1)),(0),null)):null);
return lt.object.call_behavior_reaction.cljs$core$IFn$_invoke$arity$variadic((arguments[(0)]),argseq__4778__auto__);
});

(lt.object.call_behavior_reaction.cljs$core$IFn$_invoke$arity$variadic = (function (id,args){
var behavior_fn = new cljs.core.Keyword(null,"reaction","reaction",490869788).cljs$core$IFn$_invoke$arity$1(lt.object.__GT_behavior.call(null,id));
if(cljs.core.truth_(behavior_fn)){
} else {
throw (new Error("Assert failed: behavior-fn"));
}

return cljs.core.apply.call(null,behavior_fn,args);
}));

(lt.object.call_behavior_reaction.cljs$lang$maxFixedArity = (1));

/** @this {Function} */
(lt.object.call_behavior_reaction.cljs$lang$applyTo = (function (seq6273){
var G__6274 = cljs.core.first.call(null,seq6273);
var seq6273__$1 = cljs.core.next.call(null,seq6273);
var self__4758__auto__ = this;
return self__4758__auto__.cljs$core$IFn$_invoke$arity$variadic(G__6274,seq6273__$1);
}));

lt.object.update_listeners = (function lt$object$update_listeners(var_args){
var G__6279 = arguments.length;
switch (G__6279) {
case 1:
return lt.object.update_listeners.cljs$core$IFn$_invoke$arity$1((arguments[(0)]));

break;
case 2:
return lt.object.update_listeners.cljs$core$IFn$_invoke$arity$2((arguments[(0)]),(arguments[(1)]));

break;
default:
throw (new Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join('')));

}
});

(lt.object.update_listeners.cljs$core$IFn$_invoke$arity$1 = (function (obj){
return lt.object.update_listeners.call(null,obj,null);
}));

(lt.object.update_listeners.cljs$core$IFn$_invoke$arity$2 = (function (obj,instants){
var cur = cljs.core.deref.call(null,obj);
var behs = cljs.core.set.call(null,cljs.core.concat.call(null,new cljs.core.Keyword(null,"behaviors","behaviors",120724909).cljs$core$IFn$_invoke$arity$1(cur),lt.object.tags__GT_behaviors.call(null,new cljs.core.Keyword(null,"tags","tags",1771418977).cljs$core$IFn$_invoke$arity$1(cur))));
var trigs = lt.object.__GT_triggers.call(null,behs);
var trigs__$1 = (cljs.core.truth_(new cljs.core.Keyword(null,"object.instant-load","object.instant-load",853728870).cljs$core$IFn$_invoke$arity$1(trigs))?(function (){
lt.object.raise_STAR_.call(null,obj,new cljs.core.Keyword(null,"object.instant-load","object.instant-load",853728870).cljs$core$IFn$_invoke$arity$1(trigs),null,new cljs.core.Keyword(null,"object.instant-load","object.instant-load",853728870));

return lt.object.__GT_triggers.call(null,behs);
})()
:trigs);
var trigs__$2 = (cljs.core.truth_(instants)?trigs__$1:cljs.core.dissoc.call(null,trigs__$1,new cljs.core.Keyword(null,"object.instant","object.instant",-29936727),new cljs.core.Keyword(null,"object.instant-load","object.instant-load",853728870)));
return cljs.core.assoc.call(null,cljs.core.deref.call(null,obj),new cljs.core.Keyword(null,"listeners","listeners",394544445),trigs__$2);
}));

(lt.object.update_listeners.cljs$lang$maxFixedArity = 2);

lt.object.make_object_STAR_ = (function lt$object$make_object_STAR_(var_args){
var args__4777__auto__ = [];
var len__4771__auto___6283 = arguments.length;
var i__4772__auto___6284 = (0);
while(true){
if((i__4772__auto___6284 < len__4771__auto___6283)){
args__4777__auto__.push((arguments[i__4772__auto___6284]));

var G__6285 = (i__4772__auto___6284 + (1));
i__4772__auto___6284 = G__6285;
continue;
} else {
}
break;
}

var argseq__4778__auto__ = ((((1) < args__4777__auto__.length))?(new cljs.core.IndexedSeq(args__4777__auto__.slice((1)),(0),null)):null);
return lt.object.make_object_STAR_.cljs$core$IFn$_invoke$arity$variadic((arguments[(0)]),argseq__4778__auto__);
});

(lt.object.make_object_STAR_.cljs$core$IFn$_invoke$arity$variadic = (function (name,r){
var obj = cljs.core.merge.call(null,new cljs.core.PersistentArrayMap(null, 6, [new cljs.core.Keyword(null,"behaviors","behaviors",120724909),cljs.core.PersistentHashSet.EMPTY,new cljs.core.Keyword(null,"tags","tags",1771418977),cljs.core.PersistentHashSet.EMPTY,new cljs.core.Keyword(null,"triggers","triggers",-1443678770),cljs.core.PersistentVector.EMPTY,new cljs.core.Keyword(null,"listeners","listeners",394544445),cljs.core.PersistentArrayMap.EMPTY,new cljs.core.Keyword("lt.object","type","lt.object/type",1624522497),name,new cljs.core.Keyword(null,"children","children",-940561982),cljs.core.PersistentArrayMap.EMPTY], null),cljs.core.apply.call(null,cljs.core.hash_map,r));
return obj;
}));

(lt.object.make_object_STAR_.cljs$lang$maxFixedArity = (1));

/** @this {Function} */
(lt.object.make_object_STAR_.cljs$lang$applyTo = (function (seq6281){
var G__6282 = cljs.core.first.call(null,seq6281);
var seq6281__$1 = cljs.core.next.call(null,seq6281);
var self__4758__auto__ = this;
return self__4758__auto__.cljs$core$IFn$_invoke$arity$variadic(G__6282,seq6281__$1);
}));

lt.object.store_object_STAR_ = (function lt$object$store_object_STAR_(obj){
lt.object.add.call(null,obj);

return obj;
});
/**
 * Return all objects for given type (template name)
 */
lt.object.instances_by_type = (function lt$object$instances_by_type(type){
return cljs.core.filter.call(null,(function (p1__6286_SHARP_){
return cljs.core._EQ_.call(null,type,new cljs.core.Keyword("lt.object","type","lt.object/type",1624522497).cljs$core$IFn$_invoke$arity$1(cljs.core.deref.call(null,p1__6286_SHARP_)));
}),cljs.core.vals.call(null,cljs.core.deref.call(null,lt.object.instances)));
});
/**
 * Merge map into object
 */
lt.object.merge_BANG_ = (function lt$object$merge_BANG_(obj,m){
if(cljs.core.truth_((function (){var and__4149__auto__ = m;
if(cljs.core.truth_(and__4149__auto__)){
return (!(cljs.core.map_QMARK_.call(null,m)));
} else {
return and__4149__auto__;
}
})())){
throw (new Error(["Merge requires a map: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(m)].join('')));
} else {
}

return cljs.core.swap_BANG_.call(null,obj,cljs.core.merge,m);
});
lt.object.handle_redef = (function lt$object$handle_redef(odef){
var id = new cljs.core.Keyword("lt.object","type","lt.object/type",1624522497).cljs$core$IFn$_invoke$arity$1(odef);
var seq__6287_6293 = cljs.core.seq.call(null,lt.object.instances_by_type.call(null,id));
var chunk__6289_6294 = null;
var count__6290_6295 = (0);
var i__6291_6296 = (0);
while(true){
if((i__6291_6296 < count__6290_6295)){
var o_6297 = cljs.core._nth.call(null,chunk__6289_6294,i__6291_6296);
var o_6298__$1 = cljs.core.deref.call(null,o_6297);
var args_6299 = new cljs.core.Keyword(null,"args","args",1315556576).cljs$core$IFn$_invoke$arity$1(o_6298__$1);
var old_6300 = new cljs.core.Keyword(null,"content","content",15833224).cljs$core$IFn$_invoke$arity$1(o_6298__$1);
var behs_6301 = cljs.core.set.call(null,new cljs.core.Keyword(null,"behaviors","behaviors",120724909).cljs$core$IFn$_invoke$arity$1(o_6298__$1));
var inst_6302 = cljs.core.deref.call(null,lt.object.instances).call(null,lt.object.__GT_id.call(null,o_6298__$1));
var neue_6303 = (cljs.core.truth_(new cljs.core.Keyword(null,"init","init",-1875481434).cljs$core$IFn$_invoke$arity$1(odef))?cljs.core.apply.call(null,new cljs.core.Keyword(null,"init","init",-1875481434).cljs$core$IFn$_invoke$arity$1(odef),inst_6302,args_6299):null);
var neue_6304__$1 = ((cljs.core.vector_QMARK_.call(null,neue_6303))?singultus.core.html.call(null,neue_6303):neue_6303);
lt.object.merge_BANG_.call(null,inst_6302,new cljs.core.PersistentArrayMap(null, 3, [new cljs.core.Keyword(null,"tags","tags",1771418977),clojure.set.union.call(null,new cljs.core.Keyword(null,"tags","tags",1771418977).cljs$core$IFn$_invoke$arity$1(o_6298__$1),new cljs.core.Keyword(null,"tags","tags",1771418977).cljs$core$IFn$_invoke$arity$1(odef)),new cljs.core.Keyword(null,"behaviors","behaviors",120724909),clojure.set.union.call(null,behs_6301,cljs.core.set.call(null,new cljs.core.Keyword(null,"behaviors","behaviors",120724909).cljs$core$IFn$_invoke$arity$1(odef))),new cljs.core.Keyword(null,"content","content",15833224),neue_6304__$1], null));

lt.object.merge_BANG_.call(null,inst_6302,lt.object.update_listeners.call(null,inst_6302));

if(cljs.core.truth_((function (){var and__4149__auto__ = old_6300;
if(cljs.core.truth_(and__4149__auto__)){
return neue_6304__$1;
} else {
return and__4149__auto__;
}
})())){
lt.util.dom.replace_with.call(null,old_6300,neue_6304__$1);
} else {
}

lt.object.raise.call(null,inst_6302,new cljs.core.Keyword(null,"redef","redef",1032704258));


var G__6305 = seq__6287_6293;
var G__6306 = chunk__6289_6294;
var G__6307 = count__6290_6295;
var G__6308 = (i__6291_6296 + (1));
seq__6287_6293 = G__6305;
chunk__6289_6294 = G__6306;
count__6290_6295 = G__6307;
i__6291_6296 = G__6308;
continue;
} else {
var temp__5753__auto___6309 = cljs.core.seq.call(null,seq__6287_6293);
if(temp__5753__auto___6309){
var seq__6287_6310__$1 = temp__5753__auto___6309;
if(cljs.core.chunked_seq_QMARK_.call(null,seq__6287_6310__$1)){
var c__4591__auto___6311 = cljs.core.chunk_first.call(null,seq__6287_6310__$1);
var G__6312 = cljs.core.chunk_rest.call(null,seq__6287_6310__$1);
var G__6313 = c__4591__auto___6311;
var G__6314 = cljs.core.count.call(null,c__4591__auto___6311);
var G__6315 = (0);
seq__6287_6293 = G__6312;
chunk__6289_6294 = G__6313;
count__6290_6295 = G__6314;
i__6291_6296 = G__6315;
continue;
} else {
var o_6316 = cljs.core.first.call(null,seq__6287_6310__$1);
var o_6317__$1 = cljs.core.deref.call(null,o_6316);
var args_6318 = new cljs.core.Keyword(null,"args","args",1315556576).cljs$core$IFn$_invoke$arity$1(o_6317__$1);
var old_6319 = new cljs.core.Keyword(null,"content","content",15833224).cljs$core$IFn$_invoke$arity$1(o_6317__$1);
var behs_6320 = cljs.core.set.call(null,new cljs.core.Keyword(null,"behaviors","behaviors",120724909).cljs$core$IFn$_invoke$arity$1(o_6317__$1));
var inst_6321 = cljs.core.deref.call(null,lt.object.instances).call(null,lt.object.__GT_id.call(null,o_6317__$1));
var neue_6322 = (cljs.core.truth_(new cljs.core.Keyword(null,"init","init",-1875481434).cljs$core$IFn$_invoke$arity$1(odef))?cljs.core.apply.call(null,new cljs.core.Keyword(null,"init","init",-1875481434).cljs$core$IFn$_invoke$arity$1(odef),inst_6321,args_6318):null);
var neue_6323__$1 = ((cljs.core.vector_QMARK_.call(null,neue_6322))?singultus.core.html.call(null,neue_6322):neue_6322);
lt.object.merge_BANG_.call(null,inst_6321,new cljs.core.PersistentArrayMap(null, 3, [new cljs.core.Keyword(null,"tags","tags",1771418977),clojure.set.union.call(null,new cljs.core.Keyword(null,"tags","tags",1771418977).cljs$core$IFn$_invoke$arity$1(o_6317__$1),new cljs.core.Keyword(null,"tags","tags",1771418977).cljs$core$IFn$_invoke$arity$1(odef)),new cljs.core.Keyword(null,"behaviors","behaviors",120724909),clojure.set.union.call(null,behs_6320,cljs.core.set.call(null,new cljs.core.Keyword(null,"behaviors","behaviors",120724909).cljs$core$IFn$_invoke$arity$1(odef))),new cljs.core.Keyword(null,"content","content",15833224),neue_6323__$1], null));

lt.object.merge_BANG_.call(null,inst_6321,lt.object.update_listeners.call(null,inst_6321));

if(cljs.core.truth_((function (){var and__4149__auto__ = old_6319;
if(cljs.core.truth_(and__4149__auto__)){
return neue_6323__$1;
} else {
return and__4149__auto__;
}
})())){
lt.util.dom.replace_with.call(null,old_6319,neue_6323__$1);
} else {
}

lt.object.raise.call(null,inst_6321,new cljs.core.Keyword(null,"redef","redef",1032704258));


var G__6324 = cljs.core.next.call(null,seq__6287_6310__$1);
var G__6325 = null;
var G__6326 = (0);
var G__6327 = (0);
seq__6287_6293 = G__6324;
chunk__6289_6294 = G__6325;
count__6290_6295 = G__6326;
i__6291_6296 = G__6327;
continue;
}
} else {
}
}
break;
}

return id;
});
/**
 * Create object template (type) given keyword name and key-value pairs.
 *   These pairs serve as default attributes for an object. Following keys
 *   have special meaning:
 * 
 *   * :behaviors - Set of object's behaviors
 *   * :tags - Set of object's tags
 *   * :triggers - Set of object's triggers
 *   * :init - Init fn called when object is created. Fn's return value
 *          is hiccup html content and saved to :content
 *   * :listeners (internal) - Map of triggers to vectors of behaviors
 *   * :doc - Equivalent to a traditional function docstring.
 */
lt.object.object_STAR_ = (function lt$object$object_STAR_(var_args){
var args__4777__auto__ = [];
var len__4771__auto___6330 = arguments.length;
var i__4772__auto___6331 = (0);
while(true){
if((i__4772__auto___6331 < len__4771__auto___6330)){
args__4777__auto__.push((arguments[i__4772__auto___6331]));

var G__6332 = (i__4772__auto___6331 + (1));
i__4772__auto___6331 = G__6332;
continue;
} else {
}
break;
}

var argseq__4778__auto__ = ((((1) < args__4777__auto__.length))?(new cljs.core.IndexedSeq(args__4777__auto__.slice((1)),(0),null)):null);
return lt.object.object_STAR_.cljs$core$IFn$_invoke$arity$variadic((arguments[(0)]),argseq__4778__auto__);
});

(lt.object.object_STAR_.cljs$core$IFn$_invoke$arity$variadic = (function (name,r){
return lt.object.handle_redef.call(null,lt.object.store_object_STAR_.call(null,cljs.core.apply.call(null,lt.object.make_object_STAR_,name,r)));
}));

(lt.object.object_STAR_.cljs$lang$maxFixedArity = (1));

/** @this {Function} */
(lt.object.object_STAR_.cljs$lang$applyTo = (function (seq6328){
var G__6329 = cljs.core.first.call(null,seq6328);
var seq6328__$1 = cljs.core.next.call(null,seq6328);
var self__4758__auto__ = this;
return self__4758__auto__.cljs$core$IFn$_invoke$arity$variadic(G__6329,seq6328__$1);
}));

lt.object.make_behavior_STAR_ = (function lt$object$make_behavior_STAR_(var_args){
var args__4777__auto__ = [];
var len__4771__auto___6335 = arguments.length;
var i__4772__auto___6336 = (0);
while(true){
if((i__4772__auto___6336 < len__4771__auto___6335)){
args__4777__auto__.push((arguments[i__4772__auto___6336]));

var G__6337 = (i__4772__auto___6336 + (1));
i__4772__auto___6336 = G__6337;
continue;
} else {
}
break;
}

var argseq__4778__auto__ = ((((1) < args__4777__auto__.length))?(new cljs.core.IndexedSeq(args__4777__auto__.slice((1)),(0),null)):null);
return lt.object.make_behavior_STAR_.cljs$core$IFn$_invoke$arity$variadic((arguments[(0)]),argseq__4778__auto__);
});

(lt.object.make_behavior_STAR_.cljs$core$IFn$_invoke$arity$variadic = (function (name,r){
var be = cljs.core.merge.call(null,new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"name","name",1843675177),name], null),cljs.core.apply.call(null,cljs.core.hash_map,r));
return be;
}));

(lt.object.make_behavior_STAR_.cljs$lang$maxFixedArity = (1));

/** @this {Function} */
(lt.object.make_behavior_STAR_.cljs$lang$applyTo = (function (seq6333){
var G__6334 = cljs.core.first.call(null,seq6333);
var seq6333__$1 = cljs.core.next.call(null,seq6333);
var self__4758__auto__ = this;
return self__4758__auto__.cljs$core$IFn$_invoke$arity$variadic(G__6334,seq6333__$1);
}));

lt.object.store_behavior_STAR_ = (function lt$object$store_behavior_STAR_(beh){
lt.object.add_behavior.call(null,beh);

return new cljs.core.Keyword(null,"name","name",1843675177).cljs$core$IFn$_invoke$arity$1(beh);
});
lt.object.wrap_throttle = (function lt$object$wrap_throttle(beh){
var temp__5751__auto__ = new cljs.core.Keyword(null,"throttle","throttle",-1860340776).cljs$core$IFn$_invoke$arity$1(beh);
if(cljs.core.truth_(temp__5751__auto__)){
var thr = temp__5751__auto__;
return cljs.core.assoc.call(null,beh,new cljs.core.Keyword(null,"reaction","reaction",490869788),lt.util.js.throttle.call(null,thr,new cljs.core.Keyword(null,"reaction","reaction",490869788).cljs$core$IFn$_invoke$arity$1(beh)));
} else {
return beh;
}
});
lt.object.wrap_debounce = (function lt$object$wrap_debounce(beh){
var temp__5751__auto__ = new cljs.core.Keyword(null,"debounce","debounce",-871550296).cljs$core$IFn$_invoke$arity$1(beh);
if(cljs.core.truth_(temp__5751__auto__)){
var thr = temp__5751__auto__;
return cljs.core.assoc.call(null,beh,new cljs.core.Keyword(null,"reaction","reaction",490869788),lt.util.js.debounce.call(null,thr,new cljs.core.Keyword(null,"reaction","reaction",490869788).cljs$core$IFn$_invoke$arity$1(beh)));
} else {
return beh;
}
});
lt.object.behavior_STAR_ = (function lt$object$behavior_STAR_(var_args){
var args__4777__auto__ = [];
var len__4771__auto___6340 = arguments.length;
var i__4772__auto___6341 = (0);
while(true){
if((i__4772__auto___6341 < len__4771__auto___6340)){
args__4777__auto__.push((arguments[i__4772__auto___6341]));

var G__6342 = (i__4772__auto___6341 + (1));
i__4772__auto___6341 = G__6342;
continue;
} else {
}
break;
}

var argseq__4778__auto__ = ((((1) < args__4777__auto__.length))?(new cljs.core.IndexedSeq(args__4777__auto__.slice((1)),(0),null)):null);
return lt.object.behavior_STAR_.cljs$core$IFn$_invoke$arity$variadic((arguments[(0)]),argseq__4778__auto__);
});

(lt.object.behavior_STAR_.cljs$core$IFn$_invoke$arity$variadic = (function (name,r){
return lt.object.store_behavior_STAR_.call(null,lt.object.wrap_debounce.call(null,lt.object.wrap_throttle.call(null,cljs.core.apply.call(null,lt.object.make_behavior_STAR_,name,r))));
}));

(lt.object.behavior_STAR_.cljs$lang$maxFixedArity = (1));

/** @this {Function} */
(lt.object.behavior_STAR_.cljs$lang$applyTo = (function (seq6338){
var G__6339 = cljs.core.first.call(null,seq6338);
var seq6338__$1 = cljs.core.next.call(null,seq6338);
var self__4758__auto__ = this;
return self__4758__auto__.cljs$core$IFn$_invoke$arity$variadic(G__6339,seq6338__$1);
}));

/**
 * Reduce over invoked object's behavior fns for given trigger. Start
 *   is initial value for reduce and any args are passed to behavior fn
 */
lt.object.raise_reduce = (function lt$object$raise_reduce(var_args){
var args__4777__auto__ = [];
var len__4771__auto___6349 = arguments.length;
var i__4772__auto___6350 = (0);
while(true){
if((i__4772__auto___6350 < len__4771__auto___6349)){
args__4777__auto__.push((arguments[i__4772__auto___6350]));

var G__6351 = (i__4772__auto___6350 + (1));
i__4772__auto___6350 = G__6351;
continue;
} else {
}
break;
}

var argseq__4778__auto__ = ((((3) < args__4777__auto__.length))?(new cljs.core.IndexedSeq(args__4777__auto__.slice((3)),(0),null)):null);
return lt.object.raise_reduce.cljs$core$IFn$_invoke$arity$variadic((arguments[(0)]),(arguments[(1)]),(arguments[(2)]),argseq__4778__auto__);
});

(lt.object.raise_reduce.cljs$core$IFn$_invoke$arity$variadic = (function (obj,k,start,args){
var reactions = k.call(null,new cljs.core.Keyword(null,"listeners","listeners",394544445).cljs$core$IFn$_invoke$arity$1(cljs.core.deref.call(null,obj)));
return cljs.core.reduce.call(null,(function (res,cur){
var func = new cljs.core.Keyword(null,"reaction","reaction",490869788).cljs$core$IFn$_invoke$arity$1(lt.object.__GT_behavior.call(null,cur));
var args__$1 = ((cljs.core.coll_QMARK_.call(null,cur))?cljs.core.concat.call(null,cljs.core.rest.call(null,cur),args):args);
var meta = ((cljs.core.coll_QMARK_.call(null,cur))?cljs.core.meta.call(null,cur):cljs.core.PersistentArrayMap.EMPTY);
if(cljs.core.not.call(null,func)){
return res;
} else {
var _STAR_behavior_meta_STAR__orig_val__6347 = lt.object._STAR_behavior_meta_STAR_;
var _STAR_behavior_meta_STAR__temp_val__6348 = meta;
(lt.object._STAR_behavior_meta_STAR_ = _STAR_behavior_meta_STAR__temp_val__6348);

try{return cljs.core.apply.call(null,func,obj,res,args__$1);
}finally {(lt.object._STAR_behavior_meta_STAR_ = _STAR_behavior_meta_STAR__orig_val__6347);
}}
}),start,reactions);
}));

(lt.object.raise_reduce.cljs$lang$maxFixedArity = (3));

/** @this {Function} */
(lt.object.raise_reduce.cljs$lang$applyTo = (function (seq6343){
var G__6344 = cljs.core.first.call(null,seq6343);
var seq6343__$1 = cljs.core.next.call(null,seq6343);
var G__6345 = cljs.core.first.call(null,seq6343__$1);
var seq6343__$2 = cljs.core.next.call(null,seq6343__$1);
var G__6346 = cljs.core.first.call(null,seq6343__$2);
var seq6343__$3 = cljs.core.next.call(null,seq6343__$2);
var self__4758__auto__ = this;
return self__4758__auto__.cljs$core$IFn$_invoke$arity$variadic(G__6344,G__6345,G__6346,seq6343__$3);
}));

/**
 * Update object with update-in with [:key], fn and args
 */
lt.object.update_BANG_ = (function lt$object$update_BANG_(var_args){
var args__4777__auto__ = [];
var len__4771__auto___6355 = arguments.length;
var i__4772__auto___6356 = (0);
while(true){
if((i__4772__auto___6356 < len__4771__auto___6355)){
args__4777__auto__.push((arguments[i__4772__auto___6356]));

var G__6357 = (i__4772__auto___6356 + (1));
i__4772__auto___6356 = G__6357;
continue;
} else {
}
break;
}

var argseq__4778__auto__ = ((((1) < args__4777__auto__.length))?(new cljs.core.IndexedSeq(args__4777__auto__.slice((1)),(0),null)):null);
return lt.object.update_BANG_.cljs$core$IFn$_invoke$arity$variadic((arguments[(0)]),argseq__4778__auto__);
});

(lt.object.update_BANG_.cljs$core$IFn$_invoke$arity$variadic = (function (obj,r){
return cljs.core.swap_BANG_.call(null,obj,(function (p1__6352_SHARP_){
return cljs.core.apply.call(null,cljs.core.update_in,p1__6352_SHARP_,r);
}));
}));

(lt.object.update_BANG_.cljs$lang$maxFixedArity = (1));

/** @this {Function} */
(lt.object.update_BANG_.cljs$lang$applyTo = (function (seq6353){
var G__6354 = cljs.core.first.call(null,seq6353);
var seq6353__$1 = cljs.core.next.call(null,seq6353);
var self__4758__auto__ = this;
return self__4758__auto__.cljs$core$IFn$_invoke$arity$variadic(G__6354,seq6353__$1);
}));

/**
 * Update object with assoc-in for given key and value
 */
lt.object.assoc_in_BANG_ = (function lt$object$assoc_in_BANG_(obj,k,v){
if(cljs.core.truth_((function (){var and__4149__auto__ = k;
if(cljs.core.truth_(and__4149__auto__)){
return (!(cljs.core.sequential_QMARK_.call(null,k)));
} else {
return and__4149__auto__;
}
})())){
throw (new Error(["Associate requires a sequence of keys: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(k)].join('')));
} else {
}

return cljs.core.swap_BANG_.call(null,obj,(function (p1__6358_SHARP_){
return cljs.core.assoc_in.call(null,p1__6358_SHARP_,k,v);
}));
});
lt.object.__GT_inst = (function lt$object$__GT_inst(o){
if(cljs.core.map_QMARK_.call(null,o)){
return cljs.core.deref.call(null,lt.object.instances).call(null,lt.object.__GT_id.call(null,o));
} else {
if(singultus.binding.deref_QMARK_.call(null,o)){
return o;
} else {
return cljs.core.deref.call(null,lt.object.instances).call(null,o);

}
}
});
/**
 * Return DOM content associated with object
 */
lt.object.__GT_content = (function lt$object$__GT_content(obj){
return new cljs.core.Keyword(null,"content","content",15833224).cljs$core$IFn$_invoke$arity$1(cljs.core.deref.call(null,obj));
});
/**
 * Destroy object by calling its :destroy trigger, removing it from
 *   cache and removing associated DOM content
 */
lt.object.destroy_BANG_ = (function lt$object$destroy_BANG_(obj){
var temp__5753__auto__ = lt.object.__GT_inst.call(null,obj);
if(cljs.core.truth_(temp__5753__auto__)){
var inst = temp__5753__auto__;
lt.object.raise.call(null,inst,new cljs.core.Keyword(null,"destroy","destroy",-843660405));

cljs.core.swap_BANG_.call(null,lt.object.instances,cljs.core.dissoc,lt.object.__GT_id.call(null,inst));

if(cljs.core.truth_(lt.object.__GT_content.call(null,obj))){
lt.util.dom.remove.call(null,lt.object.__GT_content.call(null,obj));
} else {
}

return cljs.core.reset_BANG_.call(null,obj,null);
} else {
return null;
}
});
lt.object.store_inst = (function lt$object$store_inst(inst){
cljs.core.swap_BANG_.call(null,lt.object.instances,cljs.core.assoc,new cljs.core.Keyword("lt.object","id","lt.object/id",-955176977).cljs$core$IFn$_invoke$arity$1(cljs.core.deref.call(null,inst)),inst);

return inst;
});
/**
 * Create object given keyword name of object template or an object template
 *   and key-value pairs. See object* for special keys.
 *   During object creation the following happens to object in order:
 * 
 *   * :init fn is called with given args
 *   * :object.instant trigger is raised
 *   * :init trigger is raised
 */
lt.object.create = (function lt$object$create(var_args){
var args__4777__auto__ = [];
var len__4771__auto___6361 = arguments.length;
var i__4772__auto___6362 = (0);
while(true){
if((i__4772__auto___6362 < len__4771__auto___6361)){
args__4777__auto__.push((arguments[i__4772__auto___6362]));

var G__6363 = (i__4772__auto___6362 + (1));
i__4772__auto___6362 = G__6363;
continue;
} else {
}
break;
}

var argseq__4778__auto__ = ((((1) < args__4777__auto__.length))?(new cljs.core.IndexedSeq(args__4777__auto__.slice((1)),(0),null)):null);
return lt.object.create.cljs$core$IFn$_invoke$arity$variadic((arguments[(0)]),argseq__4778__auto__);
});

(lt.object.create.cljs$core$IFn$_invoke$arity$variadic = (function (obj_name,args){
var obj = (((obj_name instanceof cljs.core.Keyword))?cljs.core.deref.call(null,lt.object.object_defs).call(null,obj_name):obj_name);
var id = (function (){var or__4160__auto__ = new cljs.core.Keyword("lt.object","id","lt.object/id",-955176977).cljs$core$IFn$_invoke$arity$1(obj);
if(cljs.core.truth_(or__4160__auto__)){
return or__4160__auto__;
} else {
return cljs.core.swap_BANG_.call(null,lt.object.obj_id,cljs.core.inc);
}
})();
var inst = cljs.core.atom.call(null,cljs.core.assoc.call(null,cljs.core.dissoc.call(null,obj,new cljs.core.Keyword(null,"init","init",-1875481434)),new cljs.core.Keyword("lt.object","id","lt.object/id",-955176977),id,new cljs.core.Keyword(null,"args","args",1315556576),args,new cljs.core.Keyword(null,"behaviors","behaviors",120724909),cljs.core.set.call(null,new cljs.core.Keyword(null,"behaviors","behaviors",120724909).cljs$core$IFn$_invoke$arity$1(obj)),new cljs.core.Keyword(null,"tags","tags",1771418977),cljs.core.set.call(null,cljs.core.conj.call(null,new cljs.core.Keyword(null,"tags","tags",1771418977).cljs$core$IFn$_invoke$arity$1(obj),new cljs.core.Keyword(null,"object","object",1474613949)))));
var inst__$1 = lt.object.store_inst.call(null,inst);
var _ = lt.object.merge_BANG_.call(null,inst__$1,lt.object.update_listeners.call(null,inst__$1));
var content = (cljs.core.truth_(new cljs.core.Keyword(null,"init","init",-1875481434).cljs$core$IFn$_invoke$arity$1(obj))?cljs.core.apply.call(null,new cljs.core.Keyword(null,"init","init",-1875481434).cljs$core$IFn$_invoke$arity$1(obj),inst__$1,args):null);
var content__$1 = ((cljs.core.vector_QMARK_.call(null,content))?singultus.core.html.call(null,content):content);
var final$ = lt.object.merge_BANG_.call(null,inst__$1,new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"content","content",15833224),content__$1], null));
cljs.core.add_watch.call(null,inst__$1,new cljs.core.Keyword("lt.object","change","lt.object/change",-637349099),(function (___$1,___$2,___$3,___$4){
return lt.object.raise.call(null,inst__$1,new cljs.core.Keyword(null,"object.change","object.change",1326688845));
}));

lt.object.raise_STAR_.call(null,inst__$1,lt.object.trigger__GT_behaviors.call(null,new cljs.core.Keyword(null,"object.instant","object.instant",-29936727),new cljs.core.Keyword(null,"tags","tags",1771418977).cljs$core$IFn$_invoke$arity$1(cljs.core.deref.call(null,inst__$1))),null);

lt.object.raise.call(null,inst__$1,new cljs.core.Keyword(null,"init","init",-1875481434));

return inst__$1;
}));

(lt.object.create.cljs$lang$maxFixedArity = (1));

/** @this {Function} */
(lt.object.create.cljs$lang$applyTo = (function (seq6359){
var G__6360 = cljs.core.first.call(null,seq6359);
var seq6359__$1 = cljs.core.next.call(null,seq6359);
var self__4758__auto__ = this;
return self__4758__auto__.cljs$core$IFn$_invoke$arity$variadic(G__6360,seq6359__$1);
}));

lt.object.refresh_BANG_ = (function lt$object$refresh_BANG_(obj){
cljs.core.reset_BANG_.call(null,obj,lt.object.update_listeners.call(null,obj));

lt.object.raise_STAR_.call(null,obj,lt.object.trigger__GT_behaviors.call(null,new cljs.core.Keyword(null,"object.instant","object.instant",-29936727),new cljs.core.Keyword(null,"tags","tags",1771418977).cljs$core$IFn$_invoke$arity$1(cljs.core.deref.call(null,obj))),null);

return lt.object.raise.call(null,obj,new cljs.core.Keyword(null,"object.refresh","object.refresh",108293994));
});
/**
 * Add behavior to object and update its listeners
 */
lt.object.add_behavior_BANG_ = (function lt$object$add_behavior_BANG_(obj,behavior){
lt.object.update_BANG_.call(null,obj,new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"behaviors","behaviors",120724909)], null),cljs.core.conj,behavior);

return cljs.core.reset_BANG_.call(null,obj,lt.object.update_listeners.call(null,obj));
});
/**
 * Remove behavior from object and update its listeners
 */
lt.object.rem_behavior_BANG_ = (function lt$object$rem_behavior_BANG_(obj,behavior){
lt.object.update_BANG_.call(null,obj,new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"behaviors","behaviors",120724909)], null),(function (p1__6364_SHARP_){
return cljs.core.remove.call(null,cljs.core.PersistentHashSet.createAsIfByAssoc([behavior]),p1__6364_SHARP_);
}));

return cljs.core.reset_BANG_.call(null,obj,lt.object.update_listeners.call(null,obj));
});
lt.object.__GT_def = (function lt$object$__GT_def(def_BAR_name){
if(cljs.core.map_QMARK_.call(null,def_BAR_name)){
return def_BAR_name;
} else {
return cljs.core.deref.call(null,lt.object.object_defs).call(null,def_BAR_name);
}
});
/**
 * Find object by its unique numerical id
 */
lt.object.by_id = (function lt$object$by_id(id){
if(cljs.core.truth_(id)){
return cljs.core.deref.call(null,lt.object.instances).call(null,id);
} else {
return null;
}
});
/**
 * Find objects that have given tag
 */
lt.object.by_tag = (function lt$object$by_tag(tag){
return cljs.core.sort_by.call(null,cljs.core.comp.call(null,new cljs.core.Keyword("lt.object","id","lt.object/id",-955176977),cljs.core.deref),cljs.core.filter.call(null,(function (p1__6365_SHARP_){
var temp__5753__auto__ = new cljs.core.Keyword(null,"tags","tags",1771418977).cljs$core$IFn$_invoke$arity$1(cljs.core.deref.call(null,p1__6365_SHARP_));
if(cljs.core.truth_(temp__5753__auto__)){
var ts = temp__5753__auto__;
return ts.call(null,tag);
} else {
return null;
}
}),cljs.core.vals.call(null,cljs.core.deref.call(null,lt.object.instances))));
});
lt.object.in_tag_QMARK_ = (function lt$object$in_tag_QMARK_(tag,behavior){
return cljs.core.first.call(null,cljs.core.filter.call(null,cljs.core.PersistentHashSet.createAsIfByAssoc([behavior]),cljs.core.deref.call(null,lt.object.tags).call(null,tag)));
});
/**
 * Return truthy if object has tag
 */
lt.object.has_tag_QMARK_ = (function lt$object$has_tag_QMARK_(obj,tag){
return new cljs.core.Keyword(null,"tags","tags",1771418977).cljs$core$IFn$_invoke$arity$1(cljs.core.deref.call(null,obj)).call(null,tag);
});
/**
 * Add tags to given object and updates effected behaviors and listeners.
 *   ::tags-added trigger is raised on object after update
 */
lt.object.add_tags = (function lt$object$add_tags(obj,ts){
lt.object.update_BANG_.call(null,obj,new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"tags","tags",1771418977)], null),(function (p1__6366_SHARP_){
return cljs.core.reduce.call(null,cljs.core.conj,p1__6366_SHARP_,cljs.core.filter.call(null,cljs.core.identity,ts));
}));

cljs.core.reset_BANG_.call(null,obj,lt.object.update_listeners.call(null,obj));

lt.object.raise.call(null,obj,new cljs.core.Keyword("lt.object","tags-added","lt.object/tags-added",-1159163937),ts);

lt.object.raise_STAR_.call(null,obj,lt.object.trigger__GT_behaviors.call(null,new cljs.core.Keyword(null,"object.instant","object.instant",-29936727),ts),null);

return obj;
});
/**
 * Remove tags from given object and updates effected behaviors and listeners.
 *   ::tags-removed trigger is raised on object after update
 */
lt.object.remove_tags = (function lt$object$remove_tags(obj,ts){
var cur = cljs.core.deref.call(null,obj);
var behs = cljs.core.apply.call(null,cljs.core.concat,cljs.core.map.call(null,cljs.core.deref.call(null,lt.object.tags),ts));
var cur__$1 = cljs.core.update_in.call(null,cljs.core.update_in.call(null,cljs.core.update_in.call(null,cur,new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"tags","tags",1771418977)], null),(function (p1__6367_SHARP_){
return cljs.core.reduce.call(null,cljs.core.disj,p1__6367_SHARP_,ts);
})),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"behaviors","behaviors",120724909)], null),(function (p1__6368_SHARP_){
return cljs.core.remove.call(null,cljs.core.PersistentHashSet.createAsIfByAssoc([behs]),p1__6368_SHARP_);
})),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"listeners","listeners",394544445)], null),(function (p1__6369_SHARP_){
return cljs.core.apply.call(null,cljs.core.dissoc,p1__6369_SHARP_,ts);
}));
lt.object.merge_BANG_.call(null,obj,cur__$1);

cljs.core.reset_BANG_.call(null,obj,lt.object.update_listeners.call(null,obj));

lt.object.raise.call(null,obj,new cljs.core.Keyword("lt.object","tags-removed","lt.object/tags-removed",1746536637),ts);

return obj;
});
/**
 * Associate behaviors to given tag and refresh objects with given tag
 */
lt.object.tag_behaviors = (function lt$object$tag_behaviors(tag,behs){
cljs.core.swap_BANG_.call(null,lt.object.tags,cljs.core.update_in,new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [tag], null),(function (p1__6370_SHARP_){
return cljs.core.reduce.call(null,cljs.core.conj,(function (){var or__4160__auto__ = p1__6370_SHARP_;
if(cljs.core.truth_(or__4160__auto__)){
return or__4160__auto__;
} else {
return cljs.core.List.EMPTY;
}
})(),behs);
}));

var seq__6371_6375 = cljs.core.seq.call(null,lt.object.by_tag.call(null,tag));
var chunk__6372_6376 = null;
var count__6373_6377 = (0);
var i__6374_6378 = (0);
while(true){
if((i__6374_6378 < count__6373_6377)){
var cur_6379 = cljs.core._nth.call(null,chunk__6372_6376,i__6374_6378);
lt.object.refresh_BANG_.call(null,cur_6379);


var G__6380 = seq__6371_6375;
var G__6381 = chunk__6372_6376;
var G__6382 = count__6373_6377;
var G__6383 = (i__6374_6378 + (1));
seq__6371_6375 = G__6380;
chunk__6372_6376 = G__6381;
count__6373_6377 = G__6382;
i__6374_6378 = G__6383;
continue;
} else {
var temp__5753__auto___6384 = cljs.core.seq.call(null,seq__6371_6375);
if(temp__5753__auto___6384){
var seq__6371_6385__$1 = temp__5753__auto___6384;
if(cljs.core.chunked_seq_QMARK_.call(null,seq__6371_6385__$1)){
var c__4591__auto___6386 = cljs.core.chunk_first.call(null,seq__6371_6385__$1);
var G__6387 = cljs.core.chunk_rest.call(null,seq__6371_6385__$1);
var G__6388 = c__4591__auto___6386;
var G__6389 = cljs.core.count.call(null,c__4591__auto___6386);
var G__6390 = (0);
seq__6371_6375 = G__6387;
chunk__6372_6376 = G__6388;
count__6373_6377 = G__6389;
i__6374_6378 = G__6390;
continue;
} else {
var cur_6391 = cljs.core.first.call(null,seq__6371_6385__$1);
lt.object.refresh_BANG_.call(null,cur_6391);


var G__6392 = cljs.core.next.call(null,seq__6371_6385__$1);
var G__6393 = null;
var G__6394 = (0);
var G__6395 = (0);
seq__6371_6375 = G__6392;
chunk__6372_6376 = G__6393;
count__6373_6377 = G__6394;
i__6374_6378 = G__6395;
continue;
}
} else {
}
}
break;
}

return cljs.core.deref.call(null,lt.object.tags).call(null,tag);
});
lt.object.remove_tag_behaviors = (function lt$object$remove_tag_behaviors(tag,behs){
cljs.core.swap_BANG_.call(null,lt.object.tags,cljs.core.update_in,new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [tag], null),(function (p1__6396_SHARP_){
return cljs.core.remove.call(null,cljs.core.set.call(null,behs),(function (){var or__4160__auto__ = p1__6396_SHARP_;
if(cljs.core.truth_(or__4160__auto__)){
return or__4160__auto__;
} else {
return cljs.core.List.EMPTY;
}
})());
}));

var seq__6397 = cljs.core.seq.call(null,lt.object.by_tag.call(null,tag));
var chunk__6402 = null;
var count__6403 = (0);
var i__6404 = (0);
while(true){
if((i__6404 < count__6403)){
var cur = cljs.core._nth.call(null,chunk__6402,i__6404);
var seq__6405_6409 = cljs.core.seq.call(null,behs);
var chunk__6406_6410 = null;
var count__6407_6411 = (0);
var i__6408_6412 = (0);
while(true){
if((i__6408_6412 < count__6407_6411)){
var b_6413 = cljs.core._nth.call(null,chunk__6406_6410,i__6408_6412);
lt.object.rem_behavior_BANG_.call(null,cur,b_6413);


var G__6414 = seq__6405_6409;
var G__6415 = chunk__6406_6410;
var G__6416 = count__6407_6411;
var G__6417 = (i__6408_6412 + (1));
seq__6405_6409 = G__6414;
chunk__6406_6410 = G__6415;
count__6407_6411 = G__6416;
i__6408_6412 = G__6417;
continue;
} else {
var temp__5753__auto___6418 = cljs.core.seq.call(null,seq__6405_6409);
if(temp__5753__auto___6418){
var seq__6405_6419__$1 = temp__5753__auto___6418;
if(cljs.core.chunked_seq_QMARK_.call(null,seq__6405_6419__$1)){
var c__4591__auto___6420 = cljs.core.chunk_first.call(null,seq__6405_6419__$1);
var G__6421 = cljs.core.chunk_rest.call(null,seq__6405_6419__$1);
var G__6422 = c__4591__auto___6420;
var G__6423 = cljs.core.count.call(null,c__4591__auto___6420);
var G__6424 = (0);
seq__6405_6409 = G__6421;
chunk__6406_6410 = G__6422;
count__6407_6411 = G__6423;
i__6408_6412 = G__6424;
continue;
} else {
var b_6425 = cljs.core.first.call(null,seq__6405_6419__$1);
lt.object.rem_behavior_BANG_.call(null,cur,b_6425);


var G__6426 = cljs.core.next.call(null,seq__6405_6419__$1);
var G__6427 = null;
var G__6428 = (0);
var G__6429 = (0);
seq__6405_6409 = G__6426;
chunk__6406_6410 = G__6427;
count__6407_6411 = G__6428;
i__6408_6412 = G__6429;
continue;
}
} else {
}
}
break;
}

var G__6430 = seq__6397;
var G__6431 = chunk__6402;
var G__6432 = count__6403;
var G__6433 = (i__6404 + (1));
seq__6397 = G__6430;
chunk__6402 = G__6431;
count__6403 = G__6432;
i__6404 = G__6433;
continue;
} else {
var temp__5753__auto__ = cljs.core.seq.call(null,seq__6397);
if(temp__5753__auto__){
var seq__6397__$1 = temp__5753__auto__;
if(cljs.core.chunked_seq_QMARK_.call(null,seq__6397__$1)){
var c__4591__auto__ = cljs.core.chunk_first.call(null,seq__6397__$1);
var G__6434 = cljs.core.chunk_rest.call(null,seq__6397__$1);
var G__6435 = c__4591__auto__;
var G__6436 = cljs.core.count.call(null,c__4591__auto__);
var G__6437 = (0);
seq__6397 = G__6434;
chunk__6402 = G__6435;
count__6403 = G__6436;
i__6404 = G__6437;
continue;
} else {
var cur = cljs.core.first.call(null,seq__6397__$1);
var seq__6398_6438 = cljs.core.seq.call(null,behs);
var chunk__6399_6439 = null;
var count__6400_6440 = (0);
var i__6401_6441 = (0);
while(true){
if((i__6401_6441 < count__6400_6440)){
var b_6442 = cljs.core._nth.call(null,chunk__6399_6439,i__6401_6441);
lt.object.rem_behavior_BANG_.call(null,cur,b_6442);


var G__6443 = seq__6398_6438;
var G__6444 = chunk__6399_6439;
var G__6445 = count__6400_6440;
var G__6446 = (i__6401_6441 + (1));
seq__6398_6438 = G__6443;
chunk__6399_6439 = G__6444;
count__6400_6440 = G__6445;
i__6401_6441 = G__6446;
continue;
} else {
var temp__5753__auto___6447__$1 = cljs.core.seq.call(null,seq__6398_6438);
if(temp__5753__auto___6447__$1){
var seq__6398_6448__$1 = temp__5753__auto___6447__$1;
if(cljs.core.chunked_seq_QMARK_.call(null,seq__6398_6448__$1)){
var c__4591__auto___6449 = cljs.core.chunk_first.call(null,seq__6398_6448__$1);
var G__6450 = cljs.core.chunk_rest.call(null,seq__6398_6448__$1);
var G__6451 = c__4591__auto___6449;
var G__6452 = cljs.core.count.call(null,c__4591__auto___6449);
var G__6453 = (0);
seq__6398_6438 = G__6450;
chunk__6399_6439 = G__6451;
count__6400_6440 = G__6452;
i__6401_6441 = G__6453;
continue;
} else {
var b_6454 = cljs.core.first.call(null,seq__6398_6448__$1);
lt.object.rem_behavior_BANG_.call(null,cur,b_6454);


var G__6455 = cljs.core.next.call(null,seq__6398_6448__$1);
var G__6456 = null;
var G__6457 = (0);
var G__6458 = (0);
seq__6398_6438 = G__6455;
chunk__6399_6439 = G__6456;
count__6400_6440 = G__6457;
i__6401_6441 = G__6458;
continue;
}
} else {
}
}
break;
}

var G__6459 = cljs.core.next.call(null,seq__6397__$1);
var G__6460 = null;
var G__6461 = (0);
var G__6462 = (0);
seq__6397 = G__6459;
chunk__6402 = G__6460;
count__6403 = G__6461;
i__6404 = G__6462;
continue;
}
} else {
return null;
}
}
break;
}
});
/**
 * 
 */
lt.object.__BEH__add_tag = (function lt$object$__BEH__add_tag(this$,t){
if(cljs.core.truth_(t)){
return lt.object.add_tags.call(null,this$,((cljs.core.coll_QMARK_.call(null,t))?t:new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [t], null)));
} else {
return null;
}
});

lt.object.behavior_STAR_.call(null,new cljs.core.Keyword("lt.object","add-tag","lt.object/add-tag",-1609816422),new cljs.core.Keyword(null,"desc","desc",2093485764),"App: Add tag to object",new cljs.core.Keyword(null,"params","params",710516235),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"label","label",1718410804),"tag"], null)], null),new cljs.core.Keyword(null,"type","type",1174270348),new cljs.core.Keyword(null,"user","user",1532431356),new cljs.core.Keyword(null,"triggers","triggers",-1443678770),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"object.instant","object.instant",-29936727),null], null), null),new cljs.core.Keyword(null,"reaction","reaction",490869788),lt.object.__BEH__add_tag);
/**
 * 
 */
lt.object.__BEH__remove_tag = (function lt$object$__BEH__remove_tag(this$,t){
if(cljs.core.truth_(lt.object.has_tag_QMARK_.call(null,this$,t))){
return lt.object.remove_tags.call(null,this$,((cljs.core.coll_QMARK_.call(null,t))?t:new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [t], null)));
} else {
return null;
}
});

lt.object.behavior_STAR_.call(null,new cljs.core.Keyword("lt.object","remove-tag","lt.object/remove-tag",232842813),new cljs.core.Keyword(null,"desc","desc",2093485764),"App: Remove tag from object",new cljs.core.Keyword(null,"params","params",710516235),new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"label","label",1718410804),"tag"], null)], null),new cljs.core.Keyword(null,"type","type",1174270348),new cljs.core.Keyword(null,"user","user",1532431356),new cljs.core.Keyword(null,"triggers","triggers",-1443678770),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword(null,"object.instant","object.instant",-29936727),null,new cljs.core.Keyword("lt.object","tags-added","lt.object/tags-added",-1159163937),null], null), null),new cljs.core.Keyword(null,"reaction","reaction",490869788),lt.object.__BEH__remove_tag);
/**
 * 
 */
lt.object.__BEH__shadow_tag = (function lt$object$__BEH__shadow_tag(this$,to_shadow,to_add){
var has_shadow_QMARK_ = lt.object.has_tag_QMARK_.call(null,this$,to_shadow);
var has_add_QMARK_ = lt.object.has_tag_QMARK_.call(null,this$,to_add);
if(cljs.core.truth_((function (){var and__4149__auto__ = has_shadow_QMARK_;
if(cljs.core.truth_(and__4149__auto__)){
return cljs.core.not.call(null,has_add_QMARK_);
} else {
return and__4149__auto__;
}
})())){
return lt.object.add_tags.call(null,this$,new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [to_add], null));
} else {
if(cljs.core.truth_(((cljs.core.not.call(null,has_shadow_QMARK_))?has_add_QMARK_:false))){
return lt.object.remove_tags.call(null,this$,new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [to_add], null));
} else {
return null;

}
}
});

lt.object.behavior_STAR_.call(null,new cljs.core.Keyword("lt.object","shadow-tag","lt.object/shadow-tag",1057483313),new cljs.core.Keyword(null,"desc","desc",2093485764),"App: Shadow a tag on an object",new cljs.core.Keyword(null,"params","params",710516235),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"label","label",1718410804),"tag to shadow"], null),new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"label","label",1718410804),"tag to add"], null)], null),new cljs.core.Keyword(null,"type","type",1174270348),new cljs.core.Keyword(null,"user","user",1532431356),new cljs.core.Keyword(null,"triggers","triggers",-1443678770),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 3, [new cljs.core.Keyword(null,"object.instant","object.instant",-29936727),null,new cljs.core.Keyword("lt.object","tags-removed","lt.object/tags-removed",1746536637),null,new cljs.core.Keyword("lt.object","tags-added","lt.object/tags-added",-1159163937),null], null), null),new cljs.core.Keyword(null,"reaction","reaction",490869788),lt.object.__BEH__shadow_tag);
/**
 * 
 */
lt.object.__BEH__report_time = (function lt$object$__BEH__report_time(this$,beh,time,trigger){
if(cljs.core.truth_(lt.objs.console)){
return lt.objs.console.log([cljs.core.str.cljs$core$IFn$_invoke$arity$1(beh)," triggered by ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(trigger)," took ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(time),"ms"].join(''));
} else {
return null;
}
});

lt.object.behavior_STAR_.call(null,new cljs.core.Keyword("lt.object","report-time","lt.object/report-time",-380592527),new cljs.core.Keyword(null,"triggers","triggers",-1443678770),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"object.behavior.time","object.behavior.time",-1731850612),null], null), null),new cljs.core.Keyword(null,"reaction","reaction",490869788),lt.object.__BEH__report_time);
