// Compiled by ClojureScript 1.10.844 {}
goog.provide('lt.objs.popup');
goog.require('cljs.core');
goog.require('lt.object');
goog.require('lt.objs.command');
goog.require('lt.objs.context');
goog.require('lt.objs.canvas');
goog.require('lt.objs.keyboard');
goog.require('lt.util.dom');
lt.objs.popup._STAR_no_close_STAR_ = null;
/**
 * 
 */
lt.objs.popup.__BEH__on_click_destroy = (function lt$objs$popup$__BEH__on_click_destroy(this$){
return lt.object.raise.call(null,this$,new cljs.core.Keyword(null,"close!","close!",-2079310498));
});

lt.object.behavior_STAR_.call(null,new cljs.core.Keyword("lt.objs.popup","on-click-destroy","lt.objs.popup/on-click-destroy",-1257288811),new cljs.core.Keyword(null,"triggers","triggers",-1443678770),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"click","click",1912301393),null], null), null),new cljs.core.Keyword(null,"reaction","reaction",490869788),lt.objs.popup.__BEH__on_click_destroy);
/**
 * 
 */
lt.objs.popup.__BEH__close_BANG_ = (function lt$objs$popup$__BEH__close_BANG_(this$){
lt.object.raise.call(null,this$,new cljs.core.Keyword(null,"close","close",1835149582));

lt.object.destroy_BANG_.call(null,this$);

var temp__5751__auto__ = cljs.core.seq.call(null,lt.object.by_tag.call(null,new cljs.core.Keyword(null,"popup","popup",635890211)));
if(temp__5751__auto__){
var others = temp__5751__auto__;
return lt.objs.context.in_BANG_.call(null,new cljs.core.Keyword(null,"popup","popup",635890211),cljs.core.last.call(null,others));
} else {
return lt.objs.context.out_BANG_.call(null,new cljs.core.Keyword(null,"popup","popup",635890211));
}
});

lt.object.behavior_STAR_.call(null,new cljs.core.Keyword("lt.objs.popup","close!","lt.objs.popup/close!",1552065566),new cljs.core.Keyword(null,"triggers","triggers",-1443678770),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"close!","close!",-2079310498),null], null), null),new cljs.core.Keyword(null,"reaction","reaction",490869788),lt.objs.popup.__BEH__close_BANG_);
/**
 * 
 */
lt.objs.popup.__BEH__refocus_on_close = (function lt$objs$popup$__BEH__refocus_on_close(this$){
return lt.objs.command.exec_BANG_.call(null,new cljs.core.Keyword(null,"tabs.focus-active","tabs.focus-active",-2052283963));
});

lt.object.behavior_STAR_.call(null,new cljs.core.Keyword("lt.objs.popup","refocus-on-close","lt.objs.popup/refocus-on-close",1449031270),new cljs.core.Keyword(null,"triggers","triggers",-1443678770),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"close","close",1835149582),null], null), null),new cljs.core.Keyword(null,"reaction","reaction",490869788),lt.objs.popup.__BEH__refocus_on_close);
/**
 * 
 */
lt.objs.popup.__BEH__change_active_button = (function lt$objs$popup$__BEH__change_active_button(this$,dir){
var buttons = lt.util.dom.$$.call(null,".button",lt.object.__GT_content.call(null,this$));
var button = cljs.core.mod.call(null,(new cljs.core.Keyword(null,"button","button",1456579943).cljs$core$IFn$_invoke$arity$1(cljs.core.deref.call(null,this$)) + dir),cljs.core.count.call(null,buttons));
lt.util.dom.remove_class.call(null,(buttons[new cljs.core.Keyword(null,"button","button",1456579943).cljs$core$IFn$_invoke$arity$1(cljs.core.deref.call(null,this$))]),new cljs.core.Keyword(null,"active","active",1895962068));

lt.util.dom.add_class.call(null,(buttons[button]),new cljs.core.Keyword(null,"active","active",1895962068));

return lt.object.merge_BANG_.call(null,this$,new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"button","button",1456579943),button], null));
});

lt.object.behavior_STAR_.call(null,new cljs.core.Keyword("lt.objs.popup","change-active-button","lt.objs.popup/change-active-button",-72650248),new cljs.core.Keyword(null,"triggers","triggers",-1443678770),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"move-active","move-active",-410074174),null], null), null),new cljs.core.Keyword(null,"reaction","reaction",490869788),lt.objs.popup.__BEH__change_active_button);
/**
 * 
 */
lt.objs.popup.__BEH__exec_active = (function lt$objs$popup$__BEH__exec_active(this$){
var buttons = lt.util.dom.$$.call(null,".button",lt.object.__GT_content.call(null,this$));
return lt.util.dom.trigger.call(null,(buttons[new cljs.core.Keyword(null,"button","button",1456579943).cljs$core$IFn$_invoke$arity$1(cljs.core.deref.call(null,this$))]),new cljs.core.Keyword(null,"click","click",1912301393));
});

lt.object.behavior_STAR_.call(null,new cljs.core.Keyword("lt.objs.popup","exec-active","lt.objs.popup/exec-active",1273732381),new cljs.core.Keyword(null,"triggers","triggers",-1443678770),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"exec-active","exec-active",-1470413731),null], null), null),new cljs.core.Keyword(null,"reaction","reaction",490869788),lt.objs.popup.__BEH__exec_active);
lt.objs.popup.remain_open = (function lt$objs$popup$remain_open(){
return (lt.objs.popup._STAR_no_close_STAR_ = true);
});
/**
 * 
 */
lt.objs.popup.__GT_button = (function lt$objs$popup$__GT_button(this$,p__9058){
var map__9059 = p__9058;
var map__9059__$1 = cljs.core.__destructure_map.call(null,map__9059);
var label = cljs.core.get.call(null,map__9059__$1,new cljs.core.Keyword(null,"label","label",1718410804));
var action = cljs.core.get.call(null,map__9059__$1,new cljs.core.Keyword(null,"action","action",-811238024));
var post_action = cljs.core.get.call(null,map__9059__$1,new cljs.core.Keyword(null,"post-action","post-action",-542405960));
var e__992__auto__ = singultus.core.html.call(null,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"li.button","li.button",-182721201),label], null));
var seq__9060_9080 = cljs.core.seq.call(null,cljs.core.partition.call(null,(2),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"click","click",1912301393),((function (e__992__auto__,map__9059,map__9059__$1,label,action,post_action){
return (function (){
var _STAR_no_close_STAR__orig_val__9072 = lt.objs.popup._STAR_no_close_STAR_;
var _STAR_no_close_STAR__temp_val__9073 = null;
(lt.objs.popup._STAR_no_close_STAR_ = _STAR_no_close_STAR__temp_val__9073);

try{if(cljs.core.fn_QMARK_.call(null,action)){
action.call(null);
} else {
}

if(cljs.core.truth_(lt.objs.popup._STAR_no_close_STAR_)){
} else {
lt.object.raise.call(null,this$,new cljs.core.Keyword(null,"close!","close!",-2079310498));
}

if(cljs.core.fn_QMARK_.call(null,post_action)){
return post_action.call(null);
} else {
return null;
}
}finally {(lt.objs.popup._STAR_no_close_STAR_ = _STAR_no_close_STAR__orig_val__9072);
}});})(e__992__auto__,map__9059,map__9059__$1,label,action,post_action))
], null)));
var chunk__9061_9081 = null;
var count__9062_9082 = (0);
var i__9063_9083 = (0);
while(true){
if((i__9063_9083 < count__9062_9082)){
var vec__9074_9084 = cljs.core._nth.call(null,chunk__9061_9081,i__9063_9083);
var ev__993__auto___9085 = cljs.core.nth.call(null,vec__9074_9084,(0),null);
var func__994__auto___9086 = cljs.core.nth.call(null,vec__9074_9084,(1),null);
lt.util.dom.on.call(null,e__992__auto__,ev__993__auto___9085,func__994__auto___9086);


var G__9087 = seq__9060_9080;
var G__9088 = chunk__9061_9081;
var G__9089 = count__9062_9082;
var G__9090 = (i__9063_9083 + (1));
seq__9060_9080 = G__9087;
chunk__9061_9081 = G__9088;
count__9062_9082 = G__9089;
i__9063_9083 = G__9090;
continue;
} else {
var temp__5753__auto___9091 = cljs.core.seq.call(null,seq__9060_9080);
if(temp__5753__auto___9091){
var seq__9060_9092__$1 = temp__5753__auto___9091;
if(cljs.core.chunked_seq_QMARK_.call(null,seq__9060_9092__$1)){
var c__4591__auto___9093 = cljs.core.chunk_first.call(null,seq__9060_9092__$1);
var G__9094 = cljs.core.chunk_rest.call(null,seq__9060_9092__$1);
var G__9095 = c__4591__auto___9093;
var G__9096 = cljs.core.count.call(null,c__4591__auto___9093);
var G__9097 = (0);
seq__9060_9080 = G__9094;
chunk__9061_9081 = G__9095;
count__9062_9082 = G__9096;
i__9063_9083 = G__9097;
continue;
} else {
var vec__9077_9098 = cljs.core.first.call(null,seq__9060_9092__$1);
var ev__993__auto___9099 = cljs.core.nth.call(null,vec__9077_9098,(0),null);
var func__994__auto___9100 = cljs.core.nth.call(null,vec__9077_9098,(1),null);
lt.util.dom.on.call(null,e__992__auto__,ev__993__auto___9099,func__994__auto___9100);


var G__9101 = cljs.core.next.call(null,seq__9060_9092__$1);
var G__9102 = null;
var G__9103 = (0);
var G__9104 = (0);
seq__9060_9080 = G__9101;
chunk__9061_9081 = G__9102;
count__9062_9082 = G__9103;
i__9063_9083 = G__9104;
continue;
}
} else {
}
}
break;
}

return e__992__auto__;
});
/**
 * 
 */
lt.objs.popup.popup_content = (function lt$objs$popup$popup_content(this$,opts){
var e__992__auto__ = singultus.core.html.call(null,new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"div","div",1057191632),new cljs.core.PersistentVector(null, 4, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"div","div",1057191632),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"h2","h2",-372662728),new cljs.core.Keyword(null,"header","header",119441134).cljs$core$IFn$_invoke$arity$1(opts)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"p","p",151049309),new cljs.core.Keyword(null,"body","body",-2049205669).cljs$core$IFn$_invoke$arity$1(opts)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"ul.buttons","ul.buttons",165942935),(function (){var iter__4564__auto__ = (function lt$objs$popup$popup_content_$_iter__9105(s__9106){
return (new cljs.core.LazySeq(null,(function (){
var s__9106__$1 = s__9106;
while(true){
var temp__5753__auto__ = cljs.core.seq.call(null,s__9106__$1);
if(temp__5753__auto__){
var s__9106__$2 = temp__5753__auto__;
if(cljs.core.chunked_seq_QMARK_.call(null,s__9106__$2)){
var c__4562__auto__ = cljs.core.chunk_first.call(null,s__9106__$2);
var size__4563__auto__ = cljs.core.count.call(null,c__4562__auto__);
var b__9108 = cljs.core.chunk_buffer.call(null,size__4563__auto__);
if((function (){var i__9107 = (0);
while(true){
if((i__9107 < size__4563__auto__)){
var b = cljs.core._nth.call(null,c__4562__auto__,i__9107);
cljs.core.chunk_append.call(null,b__9108,lt.objs.popup.__GT_button.call(null,this$,b));

var G__9125 = (i__9107 + (1));
i__9107 = G__9125;
continue;
} else {
return true;
}
break;
}
})()){
return cljs.core.chunk_cons.call(null,cljs.core.chunk.call(null,b__9108),lt$objs$popup$popup_content_$_iter__9105.call(null,cljs.core.chunk_rest.call(null,s__9106__$2)));
} else {
return cljs.core.chunk_cons.call(null,cljs.core.chunk.call(null,b__9108),null);
}
} else {
var b = cljs.core.first.call(null,s__9106__$2);
return cljs.core.cons.call(null,lt.objs.popup.__GT_button.call(null,this$,b),lt$objs$popup$popup_content_$_iter__9105.call(null,cljs.core.rest.call(null,s__9106__$2)));
}
} else {
return null;
}
break;
}
}),null,null));
});
return iter__4564__auto__.call(null,cljs.core.reverse.call(null,new cljs.core.Keyword(null,"buttons","buttons",-1953831197).cljs$core$IFn$_invoke$arity$1(opts)));
})()], null)], null)], null));
var seq__9109_9126 = cljs.core.seq.call(null,cljs.core.partition.call(null,(2),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"click","click",1912301393),((function (e__992__auto__){
return (function (e){
lt.util.dom.prevent.call(null,e);

return lt.util.dom.stop_propagation.call(null,e);
});})(e__992__auto__))
], null)));
var chunk__9110_9127 = null;
var count__9111_9128 = (0);
var i__9112_9129 = (0);
while(true){
if((i__9112_9129 < count__9111_9128)){
var vec__9119_9130 = cljs.core._nth.call(null,chunk__9110_9127,i__9112_9129);
var ev__993__auto___9131 = cljs.core.nth.call(null,vec__9119_9130,(0),null);
var func__994__auto___9132 = cljs.core.nth.call(null,vec__9119_9130,(1),null);
lt.util.dom.on.call(null,e__992__auto__,ev__993__auto___9131,func__994__auto___9132);


var G__9133 = seq__9109_9126;
var G__9134 = chunk__9110_9127;
var G__9135 = count__9111_9128;
var G__9136 = (i__9112_9129 + (1));
seq__9109_9126 = G__9133;
chunk__9110_9127 = G__9134;
count__9111_9128 = G__9135;
i__9112_9129 = G__9136;
continue;
} else {
var temp__5753__auto___9137 = cljs.core.seq.call(null,seq__9109_9126);
if(temp__5753__auto___9137){
var seq__9109_9138__$1 = temp__5753__auto___9137;
if(cljs.core.chunked_seq_QMARK_.call(null,seq__9109_9138__$1)){
var c__4591__auto___9139 = cljs.core.chunk_first.call(null,seq__9109_9138__$1);
var G__9140 = cljs.core.chunk_rest.call(null,seq__9109_9138__$1);
var G__9141 = c__4591__auto___9139;
var G__9142 = cljs.core.count.call(null,c__4591__auto___9139);
var G__9143 = (0);
seq__9109_9126 = G__9140;
chunk__9110_9127 = G__9141;
count__9111_9128 = G__9142;
i__9112_9129 = G__9143;
continue;
} else {
var vec__9122_9144 = cljs.core.first.call(null,seq__9109_9138__$1);
var ev__993__auto___9145 = cljs.core.nth.call(null,vec__9122_9144,(0),null);
var func__994__auto___9146 = cljs.core.nth.call(null,vec__9122_9144,(1),null);
lt.util.dom.on.call(null,e__992__auto__,ev__993__auto___9145,func__994__auto___9146);


var G__9147 = cljs.core.next.call(null,seq__9109_9138__$1);
var G__9148 = null;
var G__9149 = (0);
var G__9150 = (0);
seq__9109_9126 = G__9147;
chunk__9110_9127 = G__9148;
count__9111_9128 = G__9149;
i__9112_9129 = G__9150;
continue;
}
} else {
}
}
break;
}

return e__992__auto__;
});
/**
 * 
 */
lt.objs.popup.popup = (function lt$objs$popup$popup(this$,opts){
var e__992__auto__ = singultus.core.html.call(null,new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"div.popup","div.popup",-1910008373),new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"tabindex","tabindex",338877510),(-1)], null),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"div","div",1057191632),lt.objs.popup.popup_content.call(null,this$,opts)], null)], null));
var seq__9151_9167 = cljs.core.seq.call(null,cljs.core.partition.call(null,(2),new cljs.core.PersistentVector(null, 2, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"click","click",1912301393),((function (e__992__auto__){
return (function (){
return lt.object.raise.call(null,this$,new cljs.core.Keyword(null,"click","click",1912301393));
});})(e__992__auto__))
], null)));
var chunk__9152_9168 = null;
var count__9153_9169 = (0);
var i__9154_9170 = (0);
while(true){
if((i__9154_9170 < count__9153_9169)){
var vec__9161_9171 = cljs.core._nth.call(null,chunk__9152_9168,i__9154_9170);
var ev__993__auto___9172 = cljs.core.nth.call(null,vec__9161_9171,(0),null);
var func__994__auto___9173 = cljs.core.nth.call(null,vec__9161_9171,(1),null);
lt.util.dom.on.call(null,e__992__auto__,ev__993__auto___9172,func__994__auto___9173);


var G__9174 = seq__9151_9167;
var G__9175 = chunk__9152_9168;
var G__9176 = count__9153_9169;
var G__9177 = (i__9154_9170 + (1));
seq__9151_9167 = G__9174;
chunk__9152_9168 = G__9175;
count__9153_9169 = G__9176;
i__9154_9170 = G__9177;
continue;
} else {
var temp__5753__auto___9178 = cljs.core.seq.call(null,seq__9151_9167);
if(temp__5753__auto___9178){
var seq__9151_9179__$1 = temp__5753__auto___9178;
if(cljs.core.chunked_seq_QMARK_.call(null,seq__9151_9179__$1)){
var c__4591__auto___9180 = cljs.core.chunk_first.call(null,seq__9151_9179__$1);
var G__9181 = cljs.core.chunk_rest.call(null,seq__9151_9179__$1);
var G__9182 = c__4591__auto___9180;
var G__9183 = cljs.core.count.call(null,c__4591__auto___9180);
var G__9184 = (0);
seq__9151_9167 = G__9181;
chunk__9152_9168 = G__9182;
count__9153_9169 = G__9183;
i__9154_9170 = G__9184;
continue;
} else {
var vec__9164_9185 = cljs.core.first.call(null,seq__9151_9179__$1);
var ev__993__auto___9186 = cljs.core.nth.call(null,vec__9164_9185,(0),null);
var func__994__auto___9187 = cljs.core.nth.call(null,vec__9164_9185,(1),null);
lt.util.dom.on.call(null,e__992__auto__,ev__993__auto___9186,func__994__auto___9187);


var G__9188 = cljs.core.next.call(null,seq__9151_9179__$1);
var G__9189 = null;
var G__9190 = (0);
var G__9191 = (0);
seq__9151_9167 = G__9188;
chunk__9152_9168 = G__9189;
count__9153_9169 = G__9190;
i__9154_9170 = G__9191;
continue;
}
} else {
}
}
break;
}

return e__992__auto__;
});
lt.object.object_STAR_.call(null,new cljs.core.Keyword("lt.objs.popup","popup","lt.objs.popup/popup",-600321309),new cljs.core.Keyword(null,"tags","tags",1771418977),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"popup","popup",635890211),null], null), null),new cljs.core.Keyword(null,"button","button",1456579943),(0),new cljs.core.Keyword(null,"init","init",-1875481434),(function (this$,content){
return lt.objs.popup.popup.call(null,this$,content);
}));
lt.objs.command.command.call(null,new cljs.core.PersistentArrayMap(null, 4, [new cljs.core.Keyword(null,"command","command",-894540724),new cljs.core.Keyword(null,"popup.exec-active","popup.exec-active",1247779871),new cljs.core.Keyword(null,"desc","desc",2093485764),"Popup: execute active option",new cljs.core.Keyword(null,"hidden","hidden",-312506092),true,new cljs.core.Keyword(null,"exec","exec",1625568743),(function (){
var temp__5753__auto__ = lt.objs.context.__GT_obj.call(null,new cljs.core.Keyword(null,"popup","popup",635890211));
if(cljs.core.truth_(temp__5753__auto__)){
var p = temp__5753__auto__;
return lt.object.raise.call(null,p,new cljs.core.Keyword(null,"exec-active","exec-active",-1470413731));
} else {
return null;
}
})], null));
lt.objs.command.command.call(null,new cljs.core.PersistentArrayMap(null, 4, [new cljs.core.Keyword(null,"command","command",-894540724),new cljs.core.Keyword(null,"popup.move-active","popup.move-active",1864029018),new cljs.core.Keyword(null,"desc","desc",2093485764),"Popup: move selection",new cljs.core.Keyword(null,"hidden","hidden",-312506092),true,new cljs.core.Keyword(null,"exec","exec",1625568743),(function (dir){
var temp__5753__auto__ = lt.objs.context.__GT_obj.call(null,new cljs.core.Keyword(null,"popup","popup",635890211));
if(cljs.core.truth_(temp__5753__auto__)){
var p = temp__5753__auto__;
return lt.object.raise.call(null,p,new cljs.core.Keyword(null,"move-active","move-active",-410074174),dir);
} else {
return null;
}
})], null));
lt.objs.command.command.call(null,new cljs.core.PersistentArrayMap(null, 4, [new cljs.core.Keyword(null,"command","command",-894540724),new cljs.core.Keyword(null,"popup.escape","popup.escape",96528977),new cljs.core.Keyword(null,"desc","desc",2093485764),"Popup: escape",new cljs.core.Keyword(null,"hidden","hidden",-312506092),true,new cljs.core.Keyword(null,"exec","exec",1625568743),(function (){
var temp__5753__auto__ = lt.objs.context.__GT_obj.call(null,new cljs.core.Keyword(null,"popup","popup",635890211));
if(cljs.core.truth_(temp__5753__auto__)){
var p = temp__5753__auto__;
return lt.object.raise.call(null,p,new cljs.core.Keyword(null,"click","click",1912301393));
} else {
return null;
}
})], null));
lt.objs.popup.popup_BANG_ = (function lt$objs$popup$popup_BANG_(options){
var p = lt.object.create.call(null,new cljs.core.Keyword("lt.objs.popup","popup","lt.objs.popup/popup",-600321309),options);
lt.object.raise.call(null,p,new cljs.core.Keyword(null,"move-active","move-active",-410074174),(0));

lt.util.dom.append.call(null,lt.util.dom.$.call(null,new cljs.core.Keyword(null,"body","body",-2049205669)),lt.object.__GT_content.call(null,p));

lt.object.__GT_content.call(null,p).focus();

lt.objs.context.in_BANG_.call(null,new cljs.core.Keyword(null,"popup","popup",635890211),p);

return p;
});
lt.objs.popup.cancel_button = new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword(null,"label","label",1718410804),"cancel",new cljs.core.Keyword(null,"action","action",-811238024),new cljs.core.Keyword(null,"cancel","cancel",-1964088360)], null);
