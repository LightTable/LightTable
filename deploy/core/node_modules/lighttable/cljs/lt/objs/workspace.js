// Compiled by ClojureScript 1.10.844 {}
goog.provide('lt.objs.workspace');
goog.require('cljs.core');
goog.require('lt.object');
goog.require('lt.objs.app');
goog.require('lt.objs.files');
goog.require('lt.objs.command');
goog.require('lt.objs.cache');
goog.require('lt.objs.notifos');
goog.require('lt.objs.console');
goog.require('cljs.reader');
goog.require('lt.util.load');
goog.require('lt.util.js');
goog.require('lt.util.cljs');
lt.objs.workspace.fs = require("fs");
lt.objs.workspace.max_depth = (10);
lt.objs.workspace.watch_interval = (1000);
lt.object.object_STAR_.call(null,new cljs.core.Keyword("lt.objs.workspace","workspace","lt.objs.workspace/workspace",-331461506),new cljs.core.Keyword(null,"tags","tags",1771418977),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"workspace","workspace",-1096735709),null], null), null),new cljs.core.Keyword(null,"files","files",-472457450),cljs.core.PersistentVector.EMPTY,new cljs.core.Keyword(null,"folders","folders",44248772),cljs.core.PersistentVector.EMPTY,new cljs.core.Keyword(null,"watches","watches",-273097535),cljs.core.PersistentArrayMap.EMPTY,new cljs.core.Keyword(null,"ws-behaviors","ws-behaviors",-1322175278),"",new cljs.core.Keyword(null,"init","init",-1875481434),(function (this$){
return null;
}));
lt.objs.workspace.current_ws = lt.object.create.call(null,new cljs.core.Keyword("lt.objs.workspace","workspace","lt.objs.workspace/workspace",-331461506));
lt.objs.workspace.unwatch = (function lt$objs$workspace$unwatch(watches,path,recursive_QMARK_){
if(cljs.core.truth_(watches)){
var removes = ((cljs.core.coll_QMARK_.call(null,path))?path:((cljs.core.not.call(null,recursive_QMARK_))?new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [path], null):cljs.core.filter.call(null,(function (p1__9795_SHARP_){
return (p1__9795_SHARP_.indexOf(path) > (-1));
}),cljs.core.keys.call(null,watches))
));
var seq__9796_9802 = cljs.core.seq.call(null,cljs.core.map.call(null,watches,removes));
var chunk__9798_9803 = null;
var count__9799_9804 = (0);
var i__9800_9805 = (0);
while(true){
if((i__9800_9805 < count__9799_9804)){
var r_9806 = cljs.core._nth.call(null,chunk__9798_9803,i__9800_9805);
if(cljs.core.truth_((function (){var and__4149__auto__ = r_9806;
if(cljs.core.truth_(and__4149__auto__)){
return new cljs.core.Keyword(null,"close","close",1835149582).cljs$core$IFn$_invoke$arity$1(r_9806);
} else {
return and__4149__auto__;
}
})())){
new cljs.core.Keyword(null,"close","close",1835149582).cljs$core$IFn$_invoke$arity$1(r_9806).call(null);


var G__9807 = seq__9796_9802;
var G__9808 = chunk__9798_9803;
var G__9809 = count__9799_9804;
var G__9810 = (i__9800_9805 + (1));
seq__9796_9802 = G__9807;
chunk__9798_9803 = G__9808;
count__9799_9804 = G__9809;
i__9800_9805 = G__9810;
continue;
} else {
var G__9811 = seq__9796_9802;
var G__9812 = chunk__9798_9803;
var G__9813 = count__9799_9804;
var G__9814 = (i__9800_9805 + (1));
seq__9796_9802 = G__9811;
chunk__9798_9803 = G__9812;
count__9799_9804 = G__9813;
i__9800_9805 = G__9814;
continue;
}
} else {
var temp__5753__auto___9815 = cljs.core.seq.call(null,seq__9796_9802);
if(temp__5753__auto___9815){
var seq__9796_9816__$1 = temp__5753__auto___9815;
if(cljs.core.chunked_seq_QMARK_.call(null,seq__9796_9816__$1)){
var c__4591__auto___9817 = cljs.core.chunk_first.call(null,seq__9796_9816__$1);
var G__9818 = cljs.core.chunk_rest.call(null,seq__9796_9816__$1);
var G__9819 = c__4591__auto___9817;
var G__9820 = cljs.core.count.call(null,c__4591__auto___9817);
var G__9821 = (0);
seq__9796_9802 = G__9818;
chunk__9798_9803 = G__9819;
count__9799_9804 = G__9820;
i__9800_9805 = G__9821;
continue;
} else {
var r_9822 = cljs.core.first.call(null,seq__9796_9816__$1);
if(cljs.core.truth_((function (){var and__4149__auto__ = r_9822;
if(cljs.core.truth_(and__4149__auto__)){
return new cljs.core.Keyword(null,"close","close",1835149582).cljs$core$IFn$_invoke$arity$1(r_9822);
} else {
return and__4149__auto__;
}
})())){
new cljs.core.Keyword(null,"close","close",1835149582).cljs$core$IFn$_invoke$arity$1(r_9822).call(null);


var G__9823 = cljs.core.next.call(null,seq__9796_9816__$1);
var G__9824 = null;
var G__9825 = (0);
var G__9826 = (0);
seq__9796_9802 = G__9823;
chunk__9798_9803 = G__9824;
count__9799_9804 = G__9825;
i__9800_9805 = G__9826;
continue;
} else {
var G__9827 = cljs.core.next.call(null,seq__9796_9816__$1);
var G__9828 = null;
var G__9829 = (0);
var G__9830 = (0);
seq__9796_9802 = G__9827;
chunk__9798_9803 = G__9828;
count__9799_9804 = G__9829;
i__9800_9805 = G__9830;
continue;
}
}
} else {
}
}
break;
}

return cljs.core.apply.call(null,cljs.core.dissoc,watches,removes);
} else {
return null;
}
});
lt.objs.workspace.unwatch_BANG_ = (function lt$objs$workspace$unwatch_BANG_(var_args){
var G__9832 = arguments.length;
switch (G__9832) {
case 1:
return lt.objs.workspace.unwatch_BANG_.cljs$core$IFn$_invoke$arity$1((arguments[(0)]));

break;
case 2:
return lt.objs.workspace.unwatch_BANG_.cljs$core$IFn$_invoke$arity$2((arguments[(0)]),(arguments[(1)]));

break;
default:
throw (new Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join('')));

}
});

(lt.objs.workspace.unwatch_BANG_.cljs$core$IFn$_invoke$arity$1 = (function (path){
return lt.objs.workspace.unwatch_BANG_.call(null,path,false);
}));

(lt.objs.workspace.unwatch_BANG_.cljs$core$IFn$_invoke$arity$2 = (function (path,recursive_QMARK_){
return lt.object.merge_BANG_.call(null,lt.objs.workspace.current_ws,new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"watches","watches",-273097535),lt.objs.workspace.unwatch.call(null,new cljs.core.Keyword(null,"watches","watches",-273097535).cljs$core$IFn$_invoke$arity$1(cljs.core.deref.call(null,lt.objs.workspace.current_ws)),path,recursive_QMARK_)], null));
}));

(lt.objs.workspace.unwatch_BANG_.cljs$lang$maxFixedArity = 2);

lt.objs.workspace.alert_file = (function lt$objs$workspace$alert_file(path){
return (function (cur,prev){
if(cljs.core.truth_(lt.objs.workspace.fs.existsSync(path))){
return lt.object.raise.call(null,lt.objs.workspace.current_ws,new cljs.core.Keyword(null,"watched.update","watched.update",-1798614640),path,cur);
} else {
lt.objs.workspace.unwatch_BANG_.call(null,path);

return lt.object.raise.call(null,lt.objs.workspace.current_ws,new cljs.core.Keyword(null,"watched.delete","watched.delete",-2013789460),path);
}
});
});
lt.objs.workspace.file__GT_watch = (function lt$objs$workspace$file__GT_watch(path){
var alert = lt.objs.workspace.alert_file.call(null,path);
return new cljs.core.PersistentArrayMap(null, 3, [new cljs.core.Keyword(null,"path","path",-188191168),path,new cljs.core.Keyword(null,"alert","alert",-571950580),alert,new cljs.core.Keyword(null,"close","close",1835149582),(function (){
return lt.objs.workspace.fs.unwatchFile(path,alert);
})], null);
});
lt.objs.workspace.watch_BANG_ = (function lt$objs$workspace$watch_BANG_(var_args){
var G__9835 = arguments.length;
switch (G__9835) {
case 1:
return lt.objs.workspace.watch_BANG_.cljs$core$IFn$_invoke$arity$1((arguments[(0)]));

break;
case 2:
return lt.objs.workspace.watch_BANG_.cljs$core$IFn$_invoke$arity$2((arguments[(0)]),(arguments[(1)]));

break;
case 3:
return lt.objs.workspace.watch_BANG_.cljs$core$IFn$_invoke$arity$3((arguments[(0)]),(arguments[(1)]),(arguments[(2)]));

break;
default:
throw (new Error(["Invalid arity: ",cljs.core.str.cljs$core$IFn$_invoke$arity$1(arguments.length)].join('')));

}
});

(lt.objs.workspace.watch_BANG_.cljs$core$IFn$_invoke$arity$1 = (function (path){
return lt.objs.workspace.watch_BANG_.call(null,cljs.core.transient$.call(null,cljs.core.PersistentArrayMap.EMPTY),path,null);
}));

(lt.objs.workspace.watch_BANG_.cljs$core$IFn$_invoke$arity$2 = (function (path,recursive_QMARK_){
return lt.objs.workspace.watch_BANG_.call(null,cljs.core.transient$.call(null,cljs.core.PersistentArrayMap.EMPTY),path,recursive_QMARK_);
}));

(lt.objs.workspace.watch_BANG_.cljs$core$IFn$_invoke$arity$3 = (function (results,path,recursive_QMARK_){
var seq__9836_9857 = cljs.core.seq.call(null,((cljs.core.coll_QMARK_.call(null,path))?path:new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [path], null)));
var chunk__9837_9858 = null;
var count__9838_9859 = (0);
var i__9839_9860 = (0);
while(true){
if((i__9839_9860 < count__9838_9859)){
var path_9861__$1 = cljs.core._nth.call(null,chunk__9837_9858,i__9839_9860);
if(cljs.core.truth_(cljs.core.re_seq.call(null,lt.objs.files.ignore_pattern,path_9861__$1))){
} else {
if(cljs.core.truth_(lt.objs.files.dir_QMARK_.call(null,path_9861__$1))){
var recursive_QMARK__9862__$1 = ((cljs.core.not.call(null,recursive_QMARK_))?(0):((typeof recursive_QMARK_ === 'number')?(recursive_QMARK_ - (1)):lt.objs.workspace.max_depth
));
var watch_9863 = lt.objs.workspace.folder__GT_watch.call(null,path_9861__$1);
if(cljs.core.truth_(cljs.core.get.call(null,new cljs.core.Keyword(null,"watches","watches",-273097535).cljs$core$IFn$_invoke$arity$1(cljs.core.deref.call(null,lt.objs.workspace.current_ws)),path_9861__$1))){
} else {
cljs.core.assoc_BANG_.call(null,results,path_9861__$1,watch_9863);

lt.objs.workspace.fs.watchFile(path_9861__$1,(function (){var obj9849 = ({"interval":lt.objs.workspace.watch_interval,"persistent":false});
return obj9849;
})(),new cljs.core.Keyword(null,"alert","alert",-571950580).cljs$core$IFn$_invoke$arity$1(watch_9863));
}

if((recursive_QMARK__9862__$1 > (-1))){
lt.objs.workspace.watch_BANG_.call(null,results,lt.objs.files.full_path_ls.call(null,path_9861__$1),recursive_QMARK__9862__$1);
} else {
}
} else {
if(((cljs.core.not.call(null,cljs.core.get.call(null,new cljs.core.Keyword(null,"watches","watches",-273097535).cljs$core$IFn$_invoke$arity$1(cljs.core.deref.call(null,lt.objs.workspace.current_ws)),path_9861__$1))) && (cljs.core.not.call(null,cljs.core.get.call(null,results,path_9861__$1))))){
var watch_9864 = lt.objs.workspace.file__GT_watch.call(null,path_9861__$1);
cljs.core.assoc_BANG_.call(null,results,path_9861__$1,watch_9864);

lt.objs.workspace.fs.watchFile(path_9861__$1,(function (){var obj9851 = ({"interval":lt.objs.workspace.watch_interval,"persistent":false});
return obj9851;
})(),new cljs.core.Keyword(null,"alert","alert",-571950580).cljs$core$IFn$_invoke$arity$1(watch_9864));
} else {
}
}
}


var G__9865 = seq__9836_9857;
var G__9866 = chunk__9837_9858;
var G__9867 = count__9838_9859;
var G__9868 = (i__9839_9860 + (1));
seq__9836_9857 = G__9865;
chunk__9837_9858 = G__9866;
count__9838_9859 = G__9867;
i__9839_9860 = G__9868;
continue;
} else {
var temp__5753__auto___9869 = cljs.core.seq.call(null,seq__9836_9857);
if(temp__5753__auto___9869){
var seq__9836_9870__$1 = temp__5753__auto___9869;
if(cljs.core.chunked_seq_QMARK_.call(null,seq__9836_9870__$1)){
var c__4591__auto___9871 = cljs.core.chunk_first.call(null,seq__9836_9870__$1);
var G__9872 = cljs.core.chunk_rest.call(null,seq__9836_9870__$1);
var G__9873 = c__4591__auto___9871;
var G__9874 = cljs.core.count.call(null,c__4591__auto___9871);
var G__9875 = (0);
seq__9836_9857 = G__9872;
chunk__9837_9858 = G__9873;
count__9838_9859 = G__9874;
i__9839_9860 = G__9875;
continue;
} else {
var path_9876__$1 = cljs.core.first.call(null,seq__9836_9870__$1);
if(cljs.core.truth_(cljs.core.re_seq.call(null,lt.objs.files.ignore_pattern,path_9876__$1))){
} else {
if(cljs.core.truth_(lt.objs.files.dir_QMARK_.call(null,path_9876__$1))){
var recursive_QMARK__9877__$1 = ((cljs.core.not.call(null,recursive_QMARK_))?(0):((typeof recursive_QMARK_ === 'number')?(recursive_QMARK_ - (1)):lt.objs.workspace.max_depth
));
var watch_9878 = lt.objs.workspace.folder__GT_watch.call(null,path_9876__$1);
if(cljs.core.truth_(cljs.core.get.call(null,new cljs.core.Keyword(null,"watches","watches",-273097535).cljs$core$IFn$_invoke$arity$1(cljs.core.deref.call(null,lt.objs.workspace.current_ws)),path_9876__$1))){
} else {
cljs.core.assoc_BANG_.call(null,results,path_9876__$1,watch_9878);

lt.objs.workspace.fs.watchFile(path_9876__$1,(function (){var obj9853 = ({"interval":lt.objs.workspace.watch_interval,"persistent":false});
return obj9853;
})(),new cljs.core.Keyword(null,"alert","alert",-571950580).cljs$core$IFn$_invoke$arity$1(watch_9878));
}

if((recursive_QMARK__9877__$1 > (-1))){
lt.objs.workspace.watch_BANG_.call(null,results,lt.objs.files.full_path_ls.call(null,path_9876__$1),recursive_QMARK__9877__$1);
} else {
}
} else {
if(((cljs.core.not.call(null,cljs.core.get.call(null,new cljs.core.Keyword(null,"watches","watches",-273097535).cljs$core$IFn$_invoke$arity$1(cljs.core.deref.call(null,lt.objs.workspace.current_ws)),path_9876__$1))) && (cljs.core.not.call(null,cljs.core.get.call(null,results,path_9876__$1))))){
var watch_9879 = lt.objs.workspace.file__GT_watch.call(null,path_9876__$1);
cljs.core.assoc_BANG_.call(null,results,path_9876__$1,watch_9879);

lt.objs.workspace.fs.watchFile(path_9876__$1,(function (){var obj9855 = ({"interval":lt.objs.workspace.watch_interval,"persistent":false});
return obj9855;
})(),new cljs.core.Keyword(null,"alert","alert",-571950580).cljs$core$IFn$_invoke$arity$1(watch_9879));
} else {
}
}
}


var G__9880 = cljs.core.next.call(null,seq__9836_9870__$1);
var G__9881 = null;
var G__9882 = (0);
var G__9883 = (0);
seq__9836_9857 = G__9880;
chunk__9837_9858 = G__9881;
count__9838_9859 = G__9882;
i__9839_9860 = G__9883;
continue;
}
} else {
}
}
break;
}

if(typeof recursive_QMARK_ === 'number'){
return null;
} else {
return lt.object.update_BANG_.call(null,lt.objs.workspace.current_ws,new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"watches","watches",-273097535)], null),cljs.core.merge,cljs.core.persistent_BANG_.call(null,results));
}
}));

(lt.objs.workspace.watch_BANG_.cljs$lang$maxFixedArity = 3);

lt.objs.workspace.alert_folder = (function lt$objs$workspace$alert_folder(path){
return (function (cur,prev){
if(cljs.core.truth_(lt.objs.workspace.fs.existsSync(path))){
var watches = new cljs.core.Keyword(null,"watches","watches",-273097535).cljs$core$IFn$_invoke$arity$1(cljs.core.deref.call(null,lt.objs.workspace.current_ws));
var neue = cljs.core.first.call(null,cljs.core.filter.call(null,(function (p1__9884_SHARP_){
return ((cljs.core.not.call(null,cljs.core.get.call(null,watches,p1__9884_SHARP_))) && (cljs.core.not.call(null,cljs.core.re_seq.call(null,lt.objs.files.ignore_pattern,p1__9884_SHARP_))));
}),lt.objs.files.full_path_ls.call(null,path)));
if(cljs.core.truth_(neue)){
lt.objs.workspace.watch_BANG_.call(null,neue);

return lt.object.raise.call(null,lt.objs.workspace.current_ws,new cljs.core.Keyword(null,"watched.create","watched.create",1567266238),neue,lt.objs.workspace.fs.statSync(neue));
} else {
return null;
}
} else {
lt.objs.workspace.unwatch_BANG_.call(null,path,new cljs.core.Keyword(null,"recursive","recursive",718885872));

return lt.object.raise.call(null,lt.objs.workspace.current_ws,new cljs.core.Keyword(null,"watched.delete","watched.delete",-2013789460),path);
}
});
});
lt.objs.workspace.folder__GT_watch = (function lt$objs$workspace$folder__GT_watch(path){
var alert = lt.objs.workspace.alert_folder.call(null,path);
return new cljs.core.PersistentArrayMap(null, 3, [new cljs.core.Keyword(null,"path","path",-188191168),path,new cljs.core.Keyword(null,"alert","alert",-571950580),alert,new cljs.core.Keyword(null,"close","close",1835149582),(function (){
return lt.objs.workspace.fs.unwatchFile(path,alert);
})], null);
});
lt.objs.workspace.stop_watching = (function lt$objs$workspace$stop_watching(ws){
return lt.objs.workspace.unwatch_BANG_.call(null,cljs.core.keys.call(null,new cljs.core.Keyword(null,"watches","watches",-273097535).cljs$core$IFn$_invoke$arity$1(cljs.core.deref.call(null,ws))));
});
lt.objs.workspace.watch_workspace = (function lt$objs$workspace$watch_workspace(ws){
lt.objs.workspace.stop_watching.call(null,ws);

return lt.objs.workspace.watch_BANG_.call(null,lt.object.raise_reduce.call(null,ws,new cljs.core.Keyword(null,"watch-paths+","watch-paths+",-81342563),cljs.core.PersistentVector.EMPTY));
});
lt.objs.workspace.workspace_cache_path = lt.objs.files.join.call(null,lt.objs.cache.cache_path,"workspace");
lt.objs.workspace.files_and_folders = (function lt$objs$workspace$files_and_folders(path){
return cljs.core.reduce.call(null,(function (res,cur){
var dir_QMARK_ = lt.objs.files.dir_QMARK_.call(null,cur);
if(cljs.core.truth_(cljs.core.re_seq.call(null,lt.objs.files.ignore_pattern,[cljs.core.str.cljs$core$IFn$_invoke$arity$1(lt.objs.files.basename.call(null,cur)),cljs.core.str.cljs$core$IFn$_invoke$arity$1((cljs.core.truth_(dir_QMARK_)?lt.objs.files.separator:null))].join('')))){
return res;
} else {
if(cljs.core.truth_(dir_QMARK_)){
return cljs.core.update_in.call(null,res,new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"folders","folders",44248772)], null),cljs.core.conj,cur);
} else {
return cljs.core.update_in.call(null,res,new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"files","files",-472457450)], null),cljs.core.conj,cur);
}
}
}),new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword(null,"folders","folders",44248772),cljs.core.PersistentVector.EMPTY,new cljs.core.Keyword(null,"files","files",-472457450),cljs.core.PersistentVector.EMPTY], null),lt.objs.files.full_path_ls.call(null,path));
});
lt.objs.workspace.serialize = (function lt$objs$workspace$serialize(ws){
return cljs.core.select_keys.call(null,ws,new cljs.core.PersistentVector(null, 3, 5, cljs.core.PersistentVector.EMPTY_NODE, [new cljs.core.Keyword(null,"files","files",-472457450),new cljs.core.Keyword(null,"folders","folders",44248772),new cljs.core.Keyword(null,"ws-behaviors","ws-behaviors",-1322175278)], null));
});
lt.objs.workspace.reconstitute = (function lt$objs$workspace$reconstitute(ws,v){
return lt.object.raise.call(null,ws,new cljs.core.Keyword(null,"set!","set!",-1389817006),new cljs.core.PersistentArrayMap(null, 3, [new cljs.core.Keyword(null,"files","files",-472457450),new cljs.core.Keyword(null,"files","files",-472457450).cljs$core$IFn$_invoke$arity$1(v),new cljs.core.Keyword(null,"folders","folders",44248772),cljs.core.filter.call(null,lt.objs.files.exists_QMARK_,new cljs.core.Keyword(null,"folders","folders",44248772).cljs$core$IFn$_invoke$arity$1(v)),new cljs.core.Keyword(null,"ws-behaviors","ws-behaviors",-1322175278),new cljs.core.Keyword(null,"ws-behaviors","ws-behaviors",-1322175278).cljs$core$IFn$_invoke$arity$1(v)], null));
});
lt.objs.workspace.add_BANG_ = (function lt$objs$workspace$add_BANG_(ws,k,v){
return lt.object.update_BANG_.call(null,ws,new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [k], null),cljs.core.conj,v);
});
lt.objs.workspace.remove_BANG_ = (function lt$objs$workspace$remove_BANG_(ws,k,v){
return lt.object.update_BANG_.call(null,ws,new cljs.core.PersistentVector(null, 1, 5, cljs.core.PersistentVector.EMPTY_NODE, [k], null),(function (p1__9885_SHARP_){
return cljs.core.vec.call(null,cljs.core.remove.call(null,cljs.core.PersistentHashSet.createAsIfByAssoc([v]),p1__9885_SHARP_));
}));
});
lt.objs.workspace.new_cached_file = (function lt$objs$workspace$new_cached_file(){
return [cljs.core.str.cljs$core$IFn$_invoke$arity$1(lt.util.js.now.call(null)),".clj"].join('');
});
lt.objs.workspace.file__GT_ws = (function lt$objs$workspace$file__GT_ws(file){
return cljs.core.assoc.call(null,cljs.reader.read_string.call(null,new cljs.core.Keyword(null,"content","content",15833224).cljs$core$IFn$_invoke$arity$1(lt.objs.files.open_sync.call(null,file))),new cljs.core.Keyword(null,"path","path",-188191168),file);
});
lt.objs.workspace.save = (function lt$objs$workspace$save(ws,file){
lt.objs.files.save.call(null,lt.objs.files.join.call(null,lt.objs.workspace.workspace_cache_path,file),cljs.core.pr_str.call(null,lt.objs.workspace.serialize.call(null,cljs.core.deref.call(null,ws))));

return lt.object.raise.call(null,ws,new cljs.core.Keyword(null,"save","save",1850079149));
});
lt.objs.workspace.open = (function lt$objs$workspace$open(ws,file){
var loc = (((!((file.indexOf(lt.objs.files.separator) > (-1)))))?lt.objs.files.join.call(null,lt.objs.workspace.workspace_cache_path,file):file);
lt.object.merge_BANG_.call(null,ws,new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"file","file",-1269645878),lt.objs.workspace.new_cached_file.call(null)], null));

try{lt.objs.workspace.reconstitute.call(null,ws,lt.objs.workspace.file__GT_ws.call(null,loc));

lt.objs.workspace.save.call(null,ws,new cljs.core.Keyword(null,"file","file",-1269645878).cljs$core$IFn$_invoke$arity$1(cljs.core.deref.call(null,ws)));

return lt.objs.files.delete_BANG_.call(null,loc);
}catch (e9886){var e = e9886;
return lt.objs.console.error.call(null,e);
}});
lt.objs.workspace.cached = (function lt$objs$workspace$cached(){
return cljs.core.filter.call(null,(function (p1__9887_SHARP_){
return (p1__9887_SHARP_.indexOf(".clj") > (-1));
}),lt.objs.files.full_path_ls.call(null,lt.objs.workspace.workspace_cache_path));
});
lt.objs.workspace.all = (function lt$objs$workspace$all(){
var fs = cljs.core.sort.call(null,cljs.core._GT_,lt.objs.workspace.cached.call(null));
var seq__9888_9892 = cljs.core.seq.call(null,cljs.core.drop.call(null,(20),fs));
var chunk__9889_9893 = null;
var count__9890_9894 = (0);
var i__9891_9895 = (0);
while(true){
if((i__9891_9895 < count__9890_9894)){
var file_9896 = cljs.core._nth.call(null,chunk__9889_9893,i__9891_9895);
lt.objs.files.delete_BANG_.call(null,file_9896);


var G__9897 = seq__9888_9892;
var G__9898 = chunk__9889_9893;
var G__9899 = count__9890_9894;
var G__9900 = (i__9891_9895 + (1));
seq__9888_9892 = G__9897;
chunk__9889_9893 = G__9898;
count__9890_9894 = G__9899;
i__9891_9895 = G__9900;
continue;
} else {
var temp__5753__auto___9901 = cljs.core.seq.call(null,seq__9888_9892);
if(temp__5753__auto___9901){
var seq__9888_9902__$1 = temp__5753__auto___9901;
if(cljs.core.chunked_seq_QMARK_.call(null,seq__9888_9902__$1)){
var c__4591__auto___9903 = cljs.core.chunk_first.call(null,seq__9888_9902__$1);
var G__9904 = cljs.core.chunk_rest.call(null,seq__9888_9902__$1);
var G__9905 = c__4591__auto___9903;
var G__9906 = cljs.core.count.call(null,c__4591__auto___9903);
var G__9907 = (0);
seq__9888_9892 = G__9904;
chunk__9889_9893 = G__9905;
count__9890_9894 = G__9906;
i__9891_9895 = G__9907;
continue;
} else {
var file_9908 = cljs.core.first.call(null,seq__9888_9902__$1);
lt.objs.files.delete_BANG_.call(null,file_9908);


var G__9909 = cljs.core.next.call(null,seq__9888_9902__$1);
var G__9910 = null;
var G__9911 = (0);
var G__9912 = (0);
seq__9888_9892 = G__9909;
chunk__9889_9893 = G__9910;
count__9890_9894 = G__9911;
i__9891_9895 = G__9912;
continue;
}
} else {
}
}
break;
}

return cljs.core.map.call(null,lt.objs.workspace.file__GT_ws,cljs.core.take.call(null,(20),fs));
});
lt.objs.workspace.ws_empty_QMARK_ = (function lt$objs$workspace$ws_empty_QMARK_(ws){
return (!(((cljs.core.seq.call(null,new cljs.core.Keyword(null,"files","files",-472457450).cljs$core$IFn$_invoke$arity$1(cljs.core.deref.call(null,ws)))) || (cljs.core.seq.call(null,new cljs.core.Keyword(null,"folders","folders",44248772).cljs$core$IFn$_invoke$arity$1(cljs.core.deref.call(null,ws)))))));
});
/**
 * 
 */
lt.objs.workspace.__BEH__serialize_workspace = (function lt$objs$workspace$__BEH__serialize_workspace(this$){
if(cljs.core.truth_(cljs.core.deref.call(null,this$).call(null,new cljs.core.Keyword(null,"file","file",-1269645878)))){
} else {
lt.object.merge_BANG_.call(null,this$,new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"file","file",-1269645878),lt.objs.workspace.new_cached_file.call(null)], null));
}

if(cljs.core.truth_((function (){var and__4149__auto__ = cljs.core.deref.call(null,this$).call(null,new cljs.core.Keyword(null,"initialized?","initialized?",1707939066));
if(cljs.core.truth_(and__4149__auto__)){
return (!(lt.objs.workspace.ws_empty_QMARK_.call(null,this$)));
} else {
return and__4149__auto__;
}
})())){
return lt.objs.workspace.save.call(null,this$,new cljs.core.Keyword(null,"file","file",-1269645878).cljs$core$IFn$_invoke$arity$1(cljs.core.deref.call(null,this$)));
} else {
return null;
}
});

lt.object.behavior_STAR_.call(null,new cljs.core.Keyword("lt.objs.workspace","serialize-workspace","lt.objs.workspace/serialize-workspace",811536076),new cljs.core.Keyword(null,"triggers","triggers",-1443678770),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword(null,"updated","updated",-1627192056),null,new cljs.core.Keyword(null,"serialize!","serialize!",1684731051),null], null), null),new cljs.core.Keyword(null,"reaction","reaction",490869788),lt.objs.workspace.__BEH__serialize_workspace);
/**
 * 
 */
lt.objs.workspace.__BEH__reconstitute_last_workspace = (function lt$objs$workspace$__BEH__reconstitute_last_workspace(app){
if(((lt.objs.app.first_window_QMARK_.call(null)) && (cljs.core.not.call(null,new cljs.core.Keyword(null,"initialized","initialized",-962017594).cljs$core$IFn$_invoke$arity$1(cljs.core.deref.call(null,lt.objs.workspace.current_ws)))))){
var temp__5753__auto___9913 = cljs.core.first.call(null,lt.objs.workspace.all.call(null));
if(cljs.core.truth_(temp__5753__auto___9913)){
var ws_9914 = temp__5753__auto___9913;
lt.objs.workspace.open.call(null,lt.objs.workspace.current_ws,lt.objs.files.basename.call(null,new cljs.core.Keyword(null,"path","path",-188191168).cljs$core$IFn$_invoke$arity$1(ws_9914)));
} else {
}
} else {
}

return lt.object.merge_BANG_.call(null,lt.objs.workspace.current_ws,new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"initialized?","initialized?",1707939066),true], null));
});

lt.object.behavior_STAR_.call(null,new cljs.core.Keyword("lt.objs.workspace","reconstitute-last-workspace","lt.objs.workspace/reconstitute-last-workspace",683804806),new cljs.core.Keyword(null,"triggers","triggers",-1443678770),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"post-init","post-init",1539646468),null], null), null),new cljs.core.Keyword(null,"reaction","reaction",490869788),lt.objs.workspace.__BEH__reconstitute_last_workspace);
/**
 * 
 */
lt.objs.workspace.__BEH__new_BANG_ = (function lt$objs$workspace$__BEH__new_BANG_(this$){
lt.object.merge_BANG_.call(null,this$,new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"file","file",-1269645878),lt.objs.workspace.new_cached_file.call(null)], null));

return lt.object.raise.call(null,this$,new cljs.core.Keyword(null,"clear!","clear!",-144814418));
});

lt.object.behavior_STAR_.call(null,new cljs.core.Keyword("lt.objs.workspace","new!","lt.objs.workspace/new!",1948021322),new cljs.core.Keyword(null,"triggers","triggers",-1443678770),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"new!","new!",-1640547457),null], null), null),new cljs.core.Keyword(null,"reaction","reaction",490869788),lt.objs.workspace.__BEH__new_BANG_);
/**
 * 
 */
lt.objs.workspace.__BEH__add_file_BANG_ = (function lt$objs$workspace$__BEH__add_file_BANG_(this$,f){
if((!(cljs.core.contains_QMARK_.call(null,cljs.core.set.call(null,new cljs.core.Keyword(null,"files","files",-472457450).cljs$core$IFn$_invoke$arity$1(cljs.core.deref.call(null,this$))),f)))){
lt.objs.workspace.add_BANG_.call(null,this$,new cljs.core.Keyword(null,"files","files",-472457450),f);

lt.object.raise.call(null,this$,new cljs.core.Keyword(null,"add","add",235287739),f);

return lt.object.raise.call(null,this$,new cljs.core.Keyword(null,"updated","updated",-1627192056));
} else {
return lt.objs.notifos.set_msg_BANG_.call(null,"This file is already in your workspace.",new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"class","class",-2030961996),"error"], null));
}
});

lt.object.behavior_STAR_.call(null,new cljs.core.Keyword("lt.objs.workspace","add-file!","lt.objs.workspace/add-file!",-597150562),new cljs.core.Keyword(null,"triggers","triggers",-1443678770),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"add.file!","add.file!",-439765985),null], null), null),new cljs.core.Keyword(null,"reaction","reaction",490869788),lt.objs.workspace.__BEH__add_file_BANG_);
/**
 * 
 */
lt.objs.workspace.__BEH__add_folder_BANG_ = (function lt$objs$workspace$__BEH__add_folder_BANG_(this$,f){
if((!(cljs.core.contains_QMARK_.call(null,cljs.core.set.call(null,new cljs.core.Keyword(null,"folders","folders",44248772).cljs$core$IFn$_invoke$arity$1(cljs.core.deref.call(null,this$))),f)))){
lt.objs.workspace.add_BANG_.call(null,this$,new cljs.core.Keyword(null,"folders","folders",44248772),f);

lt.object.raise.call(null,this$,new cljs.core.Keyword(null,"add","add",235287739),f);

return lt.object.raise.call(null,this$,new cljs.core.Keyword(null,"updated","updated",-1627192056));
} else {
return lt.objs.notifos.set_msg_BANG_.call(null,"This folder is already in your workspace.",new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"class","class",-2030961996),"error"], null));
}
});

lt.object.behavior_STAR_.call(null,new cljs.core.Keyword("lt.objs.workspace","add-folder!","lt.objs.workspace/add-folder!",562787277),new cljs.core.Keyword(null,"triggers","triggers",-1443678770),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"add.folder!","add.folder!",755480535),null], null), null),new cljs.core.Keyword(null,"reaction","reaction",490869788),lt.objs.workspace.__BEH__add_folder_BANG_);
/**
 * 
 */
lt.objs.workspace.__BEH__remove_file_BANG_ = (function lt$objs$workspace$__BEH__remove_file_BANG_(this$,f){
lt.objs.workspace.remove_BANG_.call(null,this$,new cljs.core.Keyword(null,"files","files",-472457450),f);

lt.object.raise.call(null,this$,new cljs.core.Keyword(null,"remove","remove",-131428414),f);

return lt.object.raise.call(null,this$,new cljs.core.Keyword(null,"updated","updated",-1627192056));
});

lt.object.behavior_STAR_.call(null,new cljs.core.Keyword("lt.objs.workspace","remove-file!","lt.objs.workspace/remove-file!",-1557591727),new cljs.core.Keyword(null,"triggers","triggers",-1443678770),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"remove.file!","remove.file!",2141287199),null], null), null),new cljs.core.Keyword(null,"reaction","reaction",490869788),lt.objs.workspace.__BEH__remove_file_BANG_);
/**
 * 
 */
lt.objs.workspace.__BEH__remove_folder_BANG_ = (function lt$objs$workspace$__BEH__remove_folder_BANG_(this$,f){
lt.objs.workspace.remove_BANG_.call(null,this$,new cljs.core.Keyword(null,"folders","folders",44248772),f);

lt.object.raise.call(null,this$,new cljs.core.Keyword(null,"remove","remove",-131428414),f);

return lt.object.raise.call(null,this$,new cljs.core.Keyword(null,"updated","updated",-1627192056));
});

lt.object.behavior_STAR_.call(null,new cljs.core.Keyword("lt.objs.workspace","remove-folder!","lt.objs.workspace/remove-folder!",1848621419),new cljs.core.Keyword(null,"triggers","triggers",-1443678770),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"remove.folder!","remove.folder!",-153450498),null], null), null),new cljs.core.Keyword(null,"reaction","reaction",490869788),lt.objs.workspace.__BEH__remove_folder_BANG_);
/**
 * 
 */
lt.objs.workspace.__BEH__rename_BANG_ = (function lt$objs$workspace$__BEH__rename_BANG_(this$,f,neue){
var key = (cljs.core.truth_(lt.objs.files.file_QMARK_.call(null,f))?new cljs.core.Keyword(null,"files","files",-472457450):new cljs.core.Keyword(null,"folders","folders",44248772));
lt.objs.workspace.remove_BANG_.call(null,this$,key,f);

lt.objs.workspace.add_BANG_.call(null,this$,key,neue);

lt.object.raise.call(null,this$,new cljs.core.Keyword(null,"rename","rename",1508157613),f,neue);

return lt.object.raise.call(null,this$,new cljs.core.Keyword(null,"updated","updated",-1627192056));
});

lt.object.behavior_STAR_.call(null,new cljs.core.Keyword("lt.objs.workspace","rename!","lt.objs.workspace/rename!",1388258695),new cljs.core.Keyword(null,"triggers","triggers",-1443678770),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"rename!","rename!",154389790),null], null), null),new cljs.core.Keyword(null,"reaction","reaction",490869788),lt.objs.workspace.__BEH__rename_BANG_);
/**
 * 
 */
lt.objs.workspace.__BEH__clear_BANG_ = (function lt$objs$workspace$__BEH__clear_BANG_(this$){
var old = cljs.core.deref.call(null,this$);
lt.object.merge_BANG_.call(null,this$,new cljs.core.PersistentArrayMap(null, 3, [new cljs.core.Keyword(null,"files","files",-472457450),cljs.core.PersistentVector.EMPTY,new cljs.core.Keyword(null,"folders","folders",44248772),cljs.core.PersistentVector.EMPTY,new cljs.core.Keyword(null,"ws-behaviors","ws-behaviors",-1322175278),""], null));

lt.object.raise.call(null,this$,new cljs.core.Keyword(null,"set","set",304602554),old);

return lt.object.raise.call(null,this$,new cljs.core.Keyword(null,"updated","updated",-1627192056));
});

lt.object.behavior_STAR_.call(null,new cljs.core.Keyword("lt.objs.workspace","clear!","lt.objs.workspace/clear!",492115735),new cljs.core.Keyword(null,"triggers","triggers",-1443678770),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"clear!","clear!",-144814418),null], null), null),new cljs.core.Keyword(null,"reaction","reaction",490869788),lt.objs.workspace.__BEH__clear_BANG_);
/**
 * 
 */
lt.objs.workspace.__BEH__set_BANG_ = (function lt$objs$workspace$__BEH__set_BANG_(this$,fs){
var old = cljs.core.deref.call(null,this$);
lt.object.merge_BANG_.call(null,this$,fs);

lt.object.raise.call(null,this$,new cljs.core.Keyword(null,"set","set",304602554),old);

return lt.object.raise.call(null,this$,new cljs.core.Keyword(null,"updated","updated",-1627192056));
});

lt.object.behavior_STAR_.call(null,new cljs.core.Keyword("lt.objs.workspace","set!","lt.objs.workspace/set!",-819966801),new cljs.core.Keyword(null,"triggers","triggers",-1443678770),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"set!","set!",-1389817006),null], null), null),new cljs.core.Keyword(null,"reaction","reaction",490869788),lt.objs.workspace.__BEH__set_BANG_);
/**
 * 
 */
lt.objs.workspace.__BEH__watch_on_set = (function lt$objs$workspace$__BEH__watch_on_set(this$){
return lt.objs.workspace.watch_workspace.call(null,this$);
});

lt.object.behavior_STAR_.call(null,new cljs.core.Keyword("lt.objs.workspace","watch-on-set","lt.objs.workspace/watch-on-set",-54426458),new cljs.core.Keyword(null,"triggers","triggers",-1443678770),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"set","set",304602554),null], null), null),new cljs.core.Keyword(null,"reaction","reaction",490869788),lt.objs.workspace.__BEH__watch_on_set);
/**
 * 
 */
lt.objs.workspace.__BEH__stop_watch_on_close = (function lt$objs$workspace$__BEH__stop_watch_on_close(app){
return lt.objs.workspace.stop_watching.call(null,lt.objs.workspace.current_ws);
});

lt.object.behavior_STAR_.call(null,new cljs.core.Keyword("lt.objs.workspace","stop-watch-on-close","lt.objs.workspace/stop-watch-on-close",1976722762),new cljs.core.Keyword(null,"triggers","triggers",-1443678770),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 2, [new cljs.core.Keyword(null,"refresh","refresh",1947415525),null,new cljs.core.Keyword(null,"close","close",1835149582),null], null), null),new cljs.core.Keyword(null,"reaction","reaction",490869788),lt.objs.workspace.__BEH__stop_watch_on_close);
/**
 * 
 */
lt.objs.workspace.__BEH__init_workspace_cache_dir = (function lt$objs$workspace$__BEH__init_workspace_cache_dir(app){
if(cljs.core.truth_(lt.objs.files.exists_QMARK_.call(null,lt.objs.workspace.workspace_cache_path))){
return null;
} else {
return lt.objs.files.mkdir.call(null,lt.objs.workspace.workspace_cache_path);
}
});

lt.object.behavior_STAR_.call(null,new cljs.core.Keyword("lt.objs.workspace","init-workspace-cache-dir","lt.objs.workspace/init-workspace-cache-dir",-307682261),new cljs.core.Keyword(null,"triggers","triggers",-1443678770),new cljs.core.PersistentHashSet(null, new cljs.core.PersistentArrayMap(null, 1, [new cljs.core.Keyword(null,"init","init",-1875481434),null], null), null),new cljs.core.Keyword(null,"reaction","reaction",490869788),lt.objs.workspace.__BEH__init_workspace_cache_dir);
lt.objs.command.command.call(null,new cljs.core.PersistentArrayMap(null, 3, [new cljs.core.Keyword(null,"command","command",-894540724),new cljs.core.Keyword(null,"workspace.new","workspace.new",-880782450),new cljs.core.Keyword(null,"desc","desc",2093485764),"Workspace: Create new workspace",new cljs.core.Keyword(null,"exec","exec",1625568743),(function (){
return lt.object.raise.call(null,lt.objs.workspace.current_ws,new cljs.core.Keyword(null,"new!","new!",-1640547457));
})], null));
